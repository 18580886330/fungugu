!function(t,e,i,s){var n=function(e,i){if(this.elm=e,this.defaults={style:{},timer:0,time:0,type:"get",dataType:"json",url:"",mustData:"",params:"",getType:"remote",otherElm:"",render:null,callBack:null,enter:null},!this.elm)throw new Error(this.elm+" 缺少ID元素");this.searchElmType="",this.autoprompting=t('<div data-type="autoprompting" data-elmid="'+this.elm.attr("id")+'" class="autoprompting" style="width:'+this.elm.width()+"px;left:"+this.elm.offset().left+"px;top:"+(this.elm.offset().top+this.elm.height()+5)+'px;">'),this.autoprompting_ul=t('<ul class="prompting_ul">'),this.autoprompting.html(this.autoprompting_ul),this.settings=t.extend({},this.defaults,i);var s="";for(var n in this.settings.mustData)s+=this.settings.mustData[n]+"/";this.settings.mustData=s.substr(0,s.lastIndexOf("/"))};n.prototype={init:function(){var e=this,i=t(this.settings.otherElm);this.elm.unbind().bind("keyup click",function(t){if(e.keywords=e.elm.val().replace(/<.[^<>]*?>|\s/g,""),""==e.keywords)return e.autoprompting&&e.autoprompting.hide();40!=t.keyCode&&38!=t.keyCode&&13!=t.keyCode&&""!=e.keywords&&(e.searchElmType="auto",e.search())}),i.length&&i.bind("click",function(){e.keywords=e.elm.val().replace(/<.[^<>]*?>|\s/g,""),""!=e.keywords&&(e.searchElmType="object",e.search())})},search:function(){var e=this;this.settings.timer&&clearTimeout(this.settings.timer),this.settings.timer=setTimeout(function(){"remote"==e.settings.getType?t.ajax({type:e.settings.type,dataType:e.settings.dataType,url:e.settings.url+encodeURIComponent(e.settings.mustData)+"/"+encodeURIComponent(e.keywords),data:e.settings.params,beforeSend:function(t){},async:e.settings.async||!0,success:function(i){e.dataResult=i.data,e.dataResult?(e.dataResult.length?e.createElment(e.dataResult):t('div[data-type="autoprompting"]').remove(),clearTimeout(e.settings.timer)):layer.msg(i.msg)},error:function(t){}}):e.createElment(e.settings.staticData)},e.settings.time||200)},createElment:function(e){var i=this,s="";if("remote"==i.settings.getType)if(1==e.length)s+=this.settings.render&&this.settings.render(e[0],1);else for(a=0;a<e.length;a++)s+=this.settings.render&&this.settings.render(e[a],e.length);else{for(var n=[],a=0;a<e.length;a++)-1==e[a].cityName.indexOf(i.keywords)&&-1==e[a].cityNameEn.indexOf(i.keywords)&&-1==e[a].spellingAlphabet.indexOf(i.keywords)||n.push(e[a]);for(a=0;a<n.length;a++)s+=this.settings.render&&this.settings.render(n[a])}if(t('div[data-type="autoprompting"]').length)this.autoprompting_ul.html(s);else{for(var o in this.settings.style)this.autoprompting.css(o,this.settings.style[o]);this.autoprompting_ul.html(s),t("body").append(this.autoprompting)}var r=this.autoprompting_ul.children();if("object"==this.searchElmType&&""!=s)return this.enterEvent(r);r.each(function(e,s){t(s).html(t(s).html().replace(new RegExp(i.keywords,"g").exec(t(s).text()),"<strong>"+i.keywords+"</strong>")).unbind("click").bind("click",function(){t(this).hasClass("disabled")||(t(this).addClass("active").siblings().removeClass("active"),i.elm.val(t(this).data().keywords),i.enterEvent(r))})}),""!=s?this.autoprompting.show().css({left:i.elm.offset().left+"px",top:i.elm.offset().top+this.elm.height()+5+"px",height:"auto",display:"block"}):this.autoprompting.hide(),yf.scroll({elmId:".autoprompting"}),this.watchkeyboard(),this.stopPropagation()},enterEvent:function(e){var i=this.autoprompting_ul.children(".active");t('div[data-type="autoprompting"]').length&&t('div[data-type="autoprompting"]').remove();var s=0;return s="remote"==this.settings.getType?this.dataResult.length:this.autoprompting_ul.children().not(".disabled").length,i.length>0?this.settings.enter&&this.settings.enter(i.data(),"",s):this.settings.enter&&this.settings.enter(e.eq(0).data(),this.keywords,s)},watchkeyboard:function(){var e=this,s=null,n=-1,a=function(t){(s=e.autoprompting_ul.children().eq(t)).addClass("active").siblings().removeClass("active"),e.elm.val(s.data().keywords).blur()};t(i).unbind("keydown").bind("keydown",function(t){var i=t.keyCode,s=e.autoprompting_ul.children().not(".disabled");if(e.autoprompting.is(":visible")&&s.length>0){var o=s.length;switch(i){case 40:++n>o-1&&(n=0),a(n);break;case 38:--n<0&&(n=o-1),a(n);break;case 13:e.enterEvent(s)}}})},stopPropagation:function(){var e=this;this.autoprompting.click(function(t){t.stopPropagation(),t.preventDefault()}),this.elm.unbind("click").bind("click",function(t){if(e.keywords=e.elm.val().replace(/<.[^<>]*?>|\s/g,""),""==e.keywords)return e.autoprompting&&e.autoprompting.hide();e.autoprompting.length&&e.autoprompting_ul.children().length&&e.search(),t.stopPropagation(),t.preventDefault()}),t("a[href]").click(function(){t('div[data-type="autoprompting"]').length&&t('div[data-type="autoprompting"]').remove()}),t(i).click(function(t){e.autoprompting.length&&e.autoprompting.hide()})}},t.fn.autoprompting=function(t){return new n(this,t).init()}}(jQuery,window,document);