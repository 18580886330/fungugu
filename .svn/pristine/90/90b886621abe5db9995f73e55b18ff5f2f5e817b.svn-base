require(["src/user/personalCenter/js/personalCenter-953478613f.server.js"],function(e){"use strict";({init:function(){this.gainDataFn(),this.gainInfoFn(),this.updatePopFn(),this.subUserInfoFn(),this.updatePwdFn(),this.cityListArr=[],this.gainPhoneFn(),this.havePhoneNum=!1,this.oldPhone=""},gainInfoFn:function(){var i=this;e.getPersonalInfo().success(function(e){if(yf.msg(e)&&e.success){var t=e.data.userInfo,s=i.countMax(e.data.trend.counts);$("#userct_name").text(t.userAccount),$("#person_surplus").html(yf.filterStr(e.data.valuationStatistics.personalUseTimes)+"条"),""!=e.data.valuationStatistics.mechanismSurplusTimes&&$("#mechanism_count").removeClass("hide"),$("#mechanism_surplus").html(yf.filterStr(e.data.valuationStatistics.mechanismSurplusTimes)+"条"),i.inquiryFn(e.data.trend.months,e.data.trend.counts,s),i.userName.val(t.userName),i.userLoginName.val(t.userAccount),""!=t.userSex?$("input[name='sex'][value='"+t.userSex+"']").attr("checked",!0):$("input[name='sex'][value='男']").attr("checked",!0),i.email.val(t.userMail),i.phone.val(t.userPhone),i.oldPhone=t.userPhone,i.outFit.val(t.userMechanism),i.branch.val(t.userDepartment),i.job.val(t.jobPosition),i.addr.val(t.userAddress),$("#user_expire").html(yf.dateStampFn(yf.filterStr(t.accountExpirationDate))),$("#sex_man").addClass("visib"),"女"==t.userSex&&($("#sex_man").hide(),$("#sex_woman").removeClass("hide").addClass("visib")),i.cityLinkageFn(e.data.cityList,t.ubietyCity,t.ubietyDistrict),""!=t.userPhone?$("#prov_phone").text("更改手机号"):i.havePhoneNum=!0}}).error(function(){})},updatePopFn:function(){$("#updatePass").off("click").click(function(){layer.open({area:["auto","auto"],type:1,closeBtn:!1,title:!1,shade:[.6,"#000"],resize:!1,content:$("#update_major"),success:function(){$("#update_major input").val("")},end:function(){$("#update_major").hide()}})})},countMax:function(e){var i=Math.max.apply(null,e);return i=0==i||i<10?20:null},inquiryFn:function(e,i,t){var s=echarts.init(document.getElementById("inquiry_line")),n={tooltip:{trigger:"axis",formatter:"{b}<br/>{a}：{c}"},grid:{y:30,height:180,containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:e},yAxis:{type:"value",max:t},series:{itemStyle:{normal:{color:"#92b8ce"}},name:"询价",type:"line",areaStyle:{normal:{}},data:i}};s.setOption(n),$(window).resize(function(){s.resize()})},subUserInfoFn:function(){var i=this;$("#subInfo").off("click").click(function(){if(i.checkRegFn()){yf.loading("#updateUserInfo");var t={userName:i.userName.val(),userSex:$('input:radio[name="sex"]:checked').val(),userDepartment:i.branch.val(),jobPosition:i.job.val(),ubietyCity:$("#user_cur_city").siblings(".layui-form-select").find(".layui-unselect").val()||"",ubietyDistrict:$("#user_cur_district").siblings(".layui-form-select").find(".layui-unselect").val()||"",userAddress:i.addr.val(),userPhone:i.phone.val(),smsCode:$("#phoneYzm").val(),userMail:i.email.val()};$("#phone_step3").hasClass("hide")||(t.userPhone=$("#newPhone").val()),e.subUserInfo(t).success(function(e){e.success?(layer.msg("修改个人信息成功"),$("#phone_step3,#phone_step2").addClass("hide"),$("#phone_step1").show(),$("#newPhone,#phoneYzm,#yzm_code").val(""),$("#changenImgCode").trigger("click"),i.gainInfoFn()):layer.msg(e.msg),yf.removeLoading("#updateUserInfo")})}})},checkRegFn:function(){var e=!0;return""==this.userName.val()||""==$.trim(this.userName.val())?(layer.tips("姓名不能为空",this.userName,{tips:[1,"#666"]}),void(e=!1)):this.regs.sepReg.test(this.userName.val())?(layer.tips("姓名不能有特殊字符",this.userName,{tips:[1,"#666"]}),void(e=!1)):""==this.email.val()||this.regs.email.test(this.email.val())?""==this.phone.val()||""==$.trim(this.phone.val())?(layer.tips("请输入手机号码",this.phone,{tips:[1,"#666"]}),void(e=!1)):this.regs.phone.test(this.phone.val())?""!=this.oldPhone&&this.oldPhone!=this.phone.val()?(layer.tips("请先验证手机号码",this.phone,{tips:[1,"#666"]}),void(e=!1)):""!=this.branch.val()&&this.regs.sepReg.test(this.branch.val())?(layer.tips("部门不能有特殊字符",this.branch,{tips:[1,"#666"]}),void(e=!1)):""!=this.job.val()&&this.regs.sepReg.test(this.job.val())?(layer.tips("职业不能有特殊字符",this.job,{tips:[1,"#666"]}),void(e=!1)):$("#phone_step2").hasClass("hide")||""!=$("#yzm_code").val()&&""!=$.trim($("#yzm_code").val())?$("#phone_step3").hasClass("hide")||""!=$("#phoneYzm").val()&&""!=$.trim($("#phoneYzm").val())?""!=this.addr.val()&&this.regs.sepReg.test(this.addr.val())?(layer.tips("地址不能有特殊字符",this.addr,{tips:[1,"#666"]}),void(e=!1)):e:(layer.tips("短信验证码不能为空","#phoneYzm",{tips:[1,"#666"]}),void(e=!1)):(layer.tips("请输入图片验证码","#yzm_code",{tips:[1,"#666"]}),void(e=!1)):(layer.tips("请输入正确的手机号码",this.phone,{tips:[1,"#666"]}),void(e=!1)):(layer.tips("请输入正确的邮箱地址",this.email,{tips:[1,"#666"]}),void(e=!1))},gainDataFn:function(){this.regs={sepReg:/[~#^$@%&！!*]/,emptyReg:/\s+/g,phone:/^1[3|4|5|7|8][0-9]\d{8}$/,email:/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/,pwd:/^(?!\D+$)(?![^a-zA-Z]+$)\S{8,16}$/},this.userName=$("#user_uName"),this.userLoginName=$("#user_uLoginName"),this.email=$("#user_uEmail"),this.branch=$("#user_uBranch"),this.job=$("#user_uJob"),this.addr=$("#user_uAddr"),this.outFit=$("#user_uOutfit"),this.phone=$("#user_uPhone"),this.pwd=$("#oldPwd"),this.newPwd=$("#newPwd"),this.newPwdAgain=$("#newPwdAgain")},updatePwdFn:function(){var i=this;$("#doUpdate").off("click").click(function(){yf.loadFile("src/content/js/third/md5/md5-4f4394c843.js",function(){var t={passwdOld:hex_md5(i.pwd.val()),passwdNew:hex_md5(i.newPwd.val())};i.checkPwdRegFn()&&e.updatePwd(t).success(function(e){e.success?(layer.closeAll(),layer.msg("密码修改成功！您已修改您的登录密码，请牢记新的密码，以便正常登陆房估估。如有疑问请致电：010-60845501",{time:0,btn:["知道了"]})):layer.tips(e.msg,i.pwd,{tips:[1,"#666"]})})})})},checkPwdRegFn:function(){var e=!0;return""==this.pwd.val()||""==$.trim(this.pwd.val())?(layer.tips("密码不能为空",this.pwd,{tips:[1,"#666"]}),void(e=!1)):""==this.newPwd.val()||""==$.trim(this.newPwd.val())?(layer.tips("新密码不能为空",this.newPwd,{tips:[1,"#666"]}),void(e=!1)):this.regs.pwd.test(this.newPwd.val())?""==this.newPwdAgain.val()||""==$.trim(this.newPwdAgain.val())?(layer.tips("确认新密码不能为空",this.newPwdAgain,{tips:[1,"#666"]}),void(e=!1)):this.regs.pwd.test(this.newPwdAgain.val())?this.newPwd.val()!=this.newPwdAgain.val()?(layer.tips("您两次输入的新密码不一致，请再次确认！",this.newPwdAgain,{tips:[1,"#666"]}),void(e=!1)):e:(layer.tips("密码长度为8~16位，必须包含字母、数字和字符任意两种以上",this.newPwdAgain,{tips:[1,"#666"]}),void(e=!1)):(layer.tips("密码长度为8~16位，必须包含字母、数字和字符任意两种以上",this.newPwd,{tips:[1,"#666"]}),void(e=!1))},cityLinkageFn:function(e,i,t){var s="",n={},a=this;this.form;for(var r=0;r<e.length;r++)s+="<option data-id="+e[r].id+" value="+e[r].MingCheng+">"+e[r].MingCheng+"</option>";$("#user_cur_city").append(s),i&&$("#user_cur_city").find("option[value='"+i+"']").attr("selected",!0),n.cityId=$("#user_cur_city").find("option:selected").attr("data-id"),this.gainDistrictsFn(n,t),layui.use(["form"],function(){a.form=layui.form,a.form.render(),a.form.on("select(curCity)",function(e){n.cityId=$("#user_cur_city").find("option[value='"+e.value+"']").attr("data-id"),a.gainDistrictsFn(n)})})},gainDistrictsFn:function(i,t){var s="",n="",a=this;if(this.cityListArr.length>0)for(var r=0;r<this.cityListArr.length;r++)if(i.cityId==this.cityListArr[r].cityId){for(var o=0;o<this.cityListArr[r].districtList.length;o++)n+="<option value="+this.cityListArr[r].districtList[o]+">"+this.cityListArr[r].districtList[o]+"</option>";return $("#user_cur_district").html(n),t&&$("#user_cur_district").find("option[value='"+t+"']").attr("selected",!0),a.form.render("select"),void setTimeout(function(){a.glorifyFn()},50)}e.getDistricts(i).success(function(e){if(yf.msg(e)){for(var n={cityId:"",districtList:""},r=[],o=0;o<e.data.length;o++)s+="<option value="+e.data[o]+">"+e.data[o]+"</option>",r.push(e.data[o]);n.cityId=i.cityId,n.districtList=r,a.cityListArr.push(n),$("#user_cur_district").html(s),t&&$("#user_cur_district").find("option[value='"+t+"']").attr("selected",!0),a.form.render("select"),a.glorifyFn()}})},gainPhoneFn:function(){var i=this;this.resCode,$("#changenImgCode").click(function(){i.changeImageCodeFn()}),$("#prov_phone").off("click").click(function(){""!=i.phone.val()&&""!=$.trim(i.phone.val())?i.regs.phone.test(i.phone.val())?($("#phone_step1").hide(),$("#phone_step2").removeClass("hide"),i.changeImageCodeFn(),$("#verityCode").off("click").click(function(){var t=$("#yzm_code").val();""!=$("#yzm_code").val()&&""!=$.trim($("#yzm_code").val())?(i.havePhoneNum&&($("#newPhone").val(i.phone.val()),$("#newPhone").attr("disabled","disabled")),e.provYzm(t).success(function(e){e.success?(i.resCode=e.data,$("#phone_step2").hide(),$("#phone_step3").removeClass("hide"),i.gainPhoneCodeFn(e.data)):layer.tips("图片验证码错误","#yzm_code",{tips:[1,"#666"]})})):layer.tips("请输入图片验证码","#yzm_code",{tips:[1,"#666"]})})):layer.tips("请输入正确的手机号码",i.phone,{tips:[1,"#666"]}):layer.tips("请输入手机号码",i.phone,{tips:[1,"#666"]})})},gainPhoneCodeFn:function(i){var t=this;$("#sendYzm").off("click").click(function(){if(!$(this).hasClass("disable"))if(""!=$("#newPhone").val()&&""!=$.trim($("#newPhone").val()))if(t.regs.phone.test($("#newPhone").val()))if(t.havePhoneNum||t.oldPhone!=$("#newPhone").val()){var s={phoneNum:$("#newPhone").val(),keyCode:i};e.getPhoneCode(s).success(function(e){e.success?yf._timer("#sendYzm",60):layer.tips(e.msg,"#phoneYzm",{tips:[1,"#666"]})})}else layer.tips("新手机号码不能与旧手机号码一致","#newPhone",{tips:[1,"#666"]});else layer.tips("请输入正确的手机号码","#newPhone",{tips:[1,"#666"]});else layer.tips("请输入手机号码","#newPhone",{tips:[1,"#666"]})})},changeImageCodeFn:function(){$("#img_code").attr("src","/api/v1/imageCodeService/refreshPicCode?"+(new Date).getTime())},banScrollFn:function(e){$(e).hover(function(){yf.stopMainScroll()},function(){yf.updateMainScroll()})},glorifyFn:function(){var e=$("#user_cur_city").siblings(".layui-unselect").find(".layui-anim"),i=$("#user_cur_district").siblings(".layui-unselect").find(".layui-anim");yf.scroll({elmId:e,height:"auto"}),yf.scroll({elmId:i,height:"auto"}),this.banScrollFn(e),this.banScrollFn(i)}}).init()});