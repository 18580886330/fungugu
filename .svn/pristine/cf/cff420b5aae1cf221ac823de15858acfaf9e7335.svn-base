require(["src/content/js/modules-2568eb3225.js","src/intelligentSearch/houseValuation/js/houseValuation-d3af3eb324.server.js"],function(t,e){"use strict";var a={init:function(){return this.data(),this.getObjects(),this.search(),this.getSpecialFactors(),this.getRecords(),this.houseReferenceArea(),this.calculateResult(0),this.gugu(),this.navEvent(),this.competingFlag=!1,yf.placeholder(),this},data:function(){var t=$("#valuationResponse");this.jTimer=t.find(".jTimer").eq(0),this.jUnitPrice=t.find(".jUnitPrice").eq(0),this.jTotalPrice=t.find(".jTotalPrice").eq(0),this.jDiscount=t.find(".jDiscount").eq(0),this.jSumPrice=t.find(".jSumPrice").eq(0),this.oValuationTool=$("#valuationTool"),this.housingName=$("#housingName")},navEvent:function(){var t=setInterval(function(){$('a[data-href="propertyValuation"]').addClass("active"),$('a[data-href="propertyValuation"]').html()&&clearInterval(t)},100)},addNullStatus:function(){$(".search-box").addClass("on"),setTimeout(function(){$(".search-box").removeClass("on")},1200)},search:function(){var t=this,e=yf.param("sval")||yf.param("alias");this.valuationInput=$("#valuationInput"),e&&this.valuationInput.val(e),$("#searchHouse").unbind("click").bind("click",function(){""==t.valuationInput.val()&&t.addNullStatus()}),this.valuationInput.autoprompting({style:{height:"auto"},time:150,url:"api/v1/propertyValuation/roomAddress/",type:"get",async:!1,dataType:"json",mustData:{city:yf.userInfo.city},params:{},otherElm:"#searchHouse",render:function(t,e){var a="";return 1==e?'<li data-keywords="'+(a=(t.buildingName||"")+(t.unitName||"")+(t.houseName||""))+'" data-residentialname="'+t.residentialName+'" data-districtname="'+t.districtName+'" data-buildingname="'+(t.buildingName||"")+'" data-buildingid="'+(t.buildingId||"")+'" data-unitname="'+(t.unitName||"")+'" data-unitid="'+(t.unitId||"")+'" data-housename="'+(t.houseName||"")+'" data-houseid="'+(t.houseId||"")+'">'+a+"("+t.residentialName+")<span>"+t.districtName||"</span></li>":(a=t.similarWord?t.similarWord:t.residentialName,'<li data-districtname="'+t.districtName+'" data-keywords="'+a+'" data-similarword="'+a+'" data-residentialname="'+t.residentialName+'">'+a+"("+t.residentialName+")<span>"+(t.districtName||"")+"</span></li>")},enter:function(t,e,a){if(1==a){var e=t.keywords;location.href="#/houseValuation?alias="+t.residentialname+"&housingName="+t.residentialname+"&istrative="+t.districtname+"&sval="+e+"&buildingName="+t.buildingname+"&buildingId="+t.buildingid+"&unitName="+t.unitname+"&unitId="+t.unitid+"&houseName="+t.housename+"&houseId="+t.houseid}else location.href="#/houseValuation?alias="+(t.similarword?t.similarword:t.residentialname)+"&housingName="+t.residentialname+"&istrative="+t.districtname+"&sval="+e;location.reload()}})},houseReferenceArea:function(){if($("#houseReference").length){this.housingName.text(yf.param("housingName"));var e=$("#houseReference").data().modules.replace(/[\[\]]/g,"").split(",");yf.tabInit("#houseReference",yf.matchModule(e)),t.referenceCase()}},calculateResult:function(e){var a=this;if(this.oValuationTool.length){var i="",n=(a=this).oValuationTool.data().modules.replace(/[\[\]]/g,"").split(","),s="";s="1"==e?"":" layui-disabled",yf.matchModule(n,function(e){console.log(e);for(var n=0;n<e.length;n++)i+='<a href="javascript:;" class="layui-btn'+s+'" data-module="'+e[n].nameEn+'">'+e[n].nameZn+"</a>";a.oValuationTool.html(i).find("a[data-module]").not(".layui-disabled").each(function(e,i){"参考均价"==$(i).text()&&(a.competingFlag=!0,$(i).addClass("layui-disabled")),$(i).unbind().bind("click",function(){if("参考均价"==$(this).text()){if($(this).hasClass("layui-disabled"))return;return $("#valuation_result").hide(),void $("#competingPrice_result").show()}t[$(this).data().module]()})})})}},getRecords:function(){var t=$("#searchLogs"),a="<span>最近搜索：</span>";e.getRecords().success(function(e){if(e.data){for(var e=e.data.list,i=0;i<e.length;i++)a+='<a href="javascript:;" data-similarword="'+e[i].xiaoQuMingCheng+'" data-districtname="'+e[i].xingZhengQu+'" data-keywords="'+e[i].xiaoQuMingCheng+'" title="'+e[i].xiaoQuMingCheng+'" class="item">'+e[i].xiaoQuMingCheng+"</a>";t.append(a).find("a").bind("click",function(){location.href="#/houseValuation?alias="+$(this).data().similarword+"&housingName="+$(this).data().keywords+"&istrative="+$(this).data().districtname})}}).error(function(t){})},getObjects:function(){return this.valuationRequire=$("#valuationRequire"),this.oHouseArea=this.valuationRequire.find('input[name="houseArea"]').eq(0),this.oEstateType=this.valuationRequire.find('select[name="estateType"]').eq(0),this.oToward=this.valuationRequire.find('select[name="toward"]').eq(0),this.oYear=this.valuationRequire.find('input[name="year"]').eq(0),this.oFloor=this.valuationRequire.find('input[name="floor"]').eq(0),this.oSumFloor=this.valuationRequire.find('input[name="sumFloor"]').eq(0),this.oSpecial=this.valuationRequire.find('select[name="special"]').eq(0),this},getHouseInfo:function(t){var a=this;this.getObjects(),this.houseData=t,e.getHouseInfos(t).success(function(t){if(!(t=t.data))return a.oEstateType.val("").next().find("input").val(""),a.oToward.val("").next().find("input").val(""),a.oYear.val(""),a.oFloor.val(""),a.oSumFloor.val(""),void a.oSpecial.val("");a.oEstateType.val("住宅").next().find("input").val("住宅"),a.oToward.val(t.toward||"").next().find("input").val(t.toward||""),a.oYear.val(t.buildDateRecord),a.oFloor.val(t.floor),a.oSumFloor.val(t.floorCount),a.oSpecial.val(""),yf.placeholder()}).error(function(t){})},getSpecialFactors:function(){if(this.oSpecial.length){var t=this,i={comName:yf.param("housingName")};e.specialFactors(i).success(function(e){var i="";if(e=e.data){for(var n=0;n<e.length;n++)i+='<option value="'+e[n]+'">'+e[n]+"</option>";t.oSpecial.append(i),a.form.render("select")}}).error(function(t){})}},gugu:function(){var t=this,a=$("#gugu"),i="",n=(new Date).getFullYear();t.oHouseArea.unbind("keyup").bind("keyup",function(){var e=$(this).val();if(!/^[1-9]\d{0,3}(\.\d{0,2})?$/.test(e)||e>9998.99)return t.oHouseArea.focus(),t.oHouseArea.val(e.length>=4?e.substr(0,4):e.substr(e.length-1)),layer.tips("请输入面积为1~9998.99，只留两位小数！",t.oHouseArea,{tips:[2,"#666"]})}),a.unbind("click").bind("click",function(){if(!a.hasClass("disabled")){var s=t.oHouseArea.val(),o=t.oYear.val(),l=t.oFloor.val(),r=t.oSumFloor.val();if(!/^[1-9]\d{0,3}(\.\d{0,2})?$/.test(s)||s>9998.99)t.oHouseArea.focus(),layer.tips("请输入面积为1~9998.99，只留两位小数！",t.oHouseArea,{tips:[2,"#666"]});else{if(""!=o&&!/^\d{4}$/.test(o))return t.oYear.focus(),layer.tips("请输入年代为1900~"+n+"的四位整数！",t.oYear,{tips:[2,"#666"]});if(""!=o&&(o<1900||o>n))return t.oYear.focus(),layer.tips("请输入年代为1900~"+n+"的四位整数！",t.oYear,{tips:[2,"#666"]});if(""!=l&&!/^\d{1,2}$|-1$/.test(l))return t.oFloor.focus(),layer.tips("所在楼层应该为-1或1~99！",t.oFloor,{tips:[2,"#666"]});if(""!=l&&"0"==l)return t.oFloor.focus(),layer.tips("所在楼层应该为-1或1~99！",t.oFloor,{tips:[2,"#666"]});if(""!=r&&!/^\d{0,2}$/.test(r))return t.oSumFloor.focus(),layer.tips("总楼层应该为1~99！",t.oSumFloor,{tips:[2,"#666"]});if(""!=r&&"0"==r)return t.oSumFloor.focus(),layer.tips("总楼层应该为1~99！",t.oSumFloor,{tips:[2,"#666"]});if(""!=l&&""!=r&&Number(l)>Number(r))return t.oFloor.focus(),layer.tips("所在楼层不能大于总楼层！",t.oFloor,{tips:[2,"#666"]});yf.loading("#valuationResponse"),i={distName:yf.param("istrative"),comName:yf.param("housingName"),area:t.oHouseArea.val(),buildingNo:t.houseData?t.houseData.buildingName:"",unitNo:t.houseData?t.houseData.unitName:"",houseNo:t.houseData?t.houseData.houseName:"",buildingYears:yf.replaceHtml(t.oYear.val())||"",floor:yf.replaceHtml(t.oFloor.val())||"",totalFloor:yf.replaceHtml(t.oSumFloor.val())||"",toward:yf.replaceHtml(t.oToward.val())||"",specialFactors:yf.replaceHtml(t.oSpecial.val())||"",houseType:yf.replaceHtml(t.oEstateType.val())||"",comAddress:yf.replaceHtml(t.valuationInput.val())||"",regionName:"",searchType:"",basePrice:"",pointX:"",pointY:""},e.gugu(i).success(function(e){var e=e.data;t.responseData(e),t.calculateResult(e?1:0),t.competingData(),a.addClass("disabled"),yf.removeLoading("#valuationResponse"),setTimeout(function(){a.removeClass("disabled")},1e3)}).error(function(t){})}}})},responseData:function(t){if(!t)return this.oValuationTool.find(".layui-btn").addClass("layui-disabled"),this.valuationId="",this.jTimer.text("--"),this.jUnitPrice.text("暂无价格").next().hide(),this.jTotalPrice.text("暂无价格").next().hide(),this.jDiscount.prop("disabled",!0).val(""),void this.jSumPrice.text("--");var e=this;this.oValuationTool.find(".layui-btn").removeClass("layui-disabled"),this.valuationId=t.valuationId,this.jTimer.text(t.valuationTime),this.jUnitPrice.text(t.vPrice).next().show(),this.jTotalPrice.text(t.vTotalPrice).next().show(),this.jDiscount.prop("disabled",!1).val(100*t.discount),this.jSumPrice.text(parseInt(t.vTotalPrice*t.discount)),this.referenceCase(),this.jDiscount.keyup(function(){var t=$(this).val();return""==t?e.jSumPrice.text("--"):/^([0-9]{1,2}|100)$/.test(t)?void e.jSumPrice.text(parseInt(e.jDiscount.val()/100*e.jTotalPrice.text())):$(this).val(t.substring(0,t.length-1))})},referenceCase:function(){yf.referenceCase&&(yf.referenceCase.main.initChartsFn("挂牌",yf.referenceCase.guapaiData,this.jUnitPrice.text()),yf.referenceCase.main.initChartsFn("成交",yf.referenceCase.successData,this.jUnitPrice.text()))},competingData:function(){if(this.competingFlag){var t=this,a={comName:yf.param("housingName")};this.backToValuation(),e.getCompetingPrice(a).success(function(e){if(200==e.code){for(var a,i="",n=[],s="暂无价格"==t.jUnitPrice.text()?0:t.jUnitPrice.text(),o=0;o<e.data.list.length;o++)n.push(Number(e.data.list[o].price));Number(e.data.caseDate.split("-")[1]);$("#competing_month").text(e.data.caseDate),n.push(Number(s)),a=Math.max.apply(null,n);for(o=0;o<e.data.list.length;o++)i+="<tr>        \t\t\t\t\t\t<td>"+e.data.list[o].source+'</td>        \t\t\t\t\t\t<td><div class="layui-progress layui-progress-big" lay-showpercent="true">                           \t\t\t \t<div class="layui-progress-bar layui-bg-blue" lay-percent="100%"  style="width:'+Math.floor(Number(e.data.list[o].price)/a*100)+'%" ></div>                   \t\t\t\t\t</div>                       \t\t\t</td>                       \t\t\t<td>'+e.data.list[o].price+"元/㎡</td>        \t\t\t\t\t</tr>";s>0&&(i+='<tr>        \t\t\t\t\t\t<td><p>估值结果</p></td>        \t\t\t\t\t\t<td><div class="layui-progress layui-progress-big" lay-showpercent="true">                           \t\t\t \t<div class="layui-progress-bar layui-bg-red" lay-percent="100%"  style="width:'+Math.floor(Number(s)/a*100)+'%" ></div>                   \t\t\t\t\t</div>                       \t\t\t</td>                       \t\t\t<td>'+s+"元/㎡</td>        \t\t\t\t\t</tr>"),$("#competing_list").html(i),layui.use(["element"],function(){layui.element}),t.oValuationTool.find("a").each(function(t,e){"参考均价"==$(e).text()&&$(e).removeClass("layui-disabled")})}else t.oValuationTool.find("a").each(function(t,e){"参考均价"==$(e).text()&&($("<div class='pop-hint-text' id='non_competition'>该小区暂无参考均价<div class='pa arrorw-down'><i class='pa upward'></i></div></div>").appendTo($("#valuationResponse")),yf.menuDown({node:$(e),showNode:$("#non_competition")}))})}).error(function(){})}},backToValuation:function(){$("#back_result").off("click").on("click",function(){$("#competingPrice_result").hide(),$("#valuation_result").show()})}}.init(),i={init:function(){return this.elm=$("#linkageBox"),this.staticPanel=$("#staticPanel"),this.parentNode=this.staticPanel.parent(),this.createDefaultTmplate(),this.bindLinkageInputEvent(),this.echoData(),this},createDefaultTmplate:function(){this.elm.html($('<div class="keybody"><input type="text" id="linkageInput" data-span="building" data-name="building" data-type="housingName" autocomplete="off" placeholder="请输入房屋坐落" class="input layui-input"></div>')),this.linkageInput=$("#linkageInput"),this.keyBody=this.elm.find(".keybody").eq(0),this.emptyhint=this.elm.find(".emptyhint").eq(0)},echoData:function(){this.isEcho=!1;var t=yf.param("buildingName"),e=yf.param("buildingId"),a=yf.param("unitName"),i=yf.param("unitId"),n=yf.param("houseName"),s=yf.param("houseId");t&&(this.isEcho=!0,this.createStaticTemplate({data:{type:"building",code:""},text:""},"building"),this.createStaticTemplate({data:{type:"building",code:e},text:t},"building")),a&&this.createStaticTemplate({data:{type:"unit",code:i},text:a},"unit"),n&&this.createStaticTemplate({data:{type:"house",code:s},text:n},"house")},createDownTemplate:function(t,e){var a=this,i=$("#result_"+t),n="";if(i.length){for(s=0;s<e.length;s++)n+='<li data-code="'+e[s].code+'" data-type="'+t+'" data-index="'+s+'">'+e[s].name+"</li>";i.show().find("ul").html(n)}else{n+='<div style="left: 0;" data-result-code="result_'+t+'" id="result_'+t+'" class="menu-result" data-index="0"><ul>';for(var s=0;s<e.length;s++)n+='<li data-code="'+e[s].code+'" data-type="'+t+'" data-index="'+s+'">'+e[s].name+"</li>";n+="</ul></div>",this.elm.append(n)}if($("#result_"+t).find("li").unbind("click").bind("click",function(){a.linkageInput.val("").attr("data-name",t),a.createStaticTemplate($(this),t),"building"==t?a.linkageInput.attr("data-span","unit"):"unit"==t&&a.linkageInput.attr("data-span","house"),a.linkageInput.focus().click()}),$(document).on("click",function(t){var e=a.elm.find(".menu-result");e.each(function(){e.is(":visible")&&(a.spanParentNode&&(a.spanParentNode.show().nextAll().show(),a.linkageInput.val(""),a.calculateStyle()),e.hide())})}),yf.scroll({elmId:".menu-result",height:"auto"}),this.isEcho){this.elm.find(".menu-result").hide();var o=this.staticPanel.children().eq(this.staticPanel.children().length-1).data().type;this.linkageInput.attr("data-span",o).attr("data-name",o)}},createStaticTemplate:function(t,e){var i=null,n="";if(t.text instanceof Function?(i=t.data(),n=t.text()):(i=t.data,n=t.text),$("#result_item_"+i.type).length>0)this.linkageInput.val(""),$("#result_item_"+i.type).show().attr({"data-type":i.type,"data-id":i.code,"data-name":n}).find("span").text(n),$("#result_item_"+i.type).nextAll(".result-item").remove();else{var s="";s+='<div class="result-item" id="result_item_'+i.type+'" data-type="'+i.type+'" data-id="'+i.code+'" data-name="'+n+'">                    <span data-type="result_'+i.type+'">'+n+'</span><a data-type="result_'+i.type+'" href="javascript:;"></a>                </div>',this.staticPanel.append(s)}this.updataParams(),$("#result_"+e).hide(),this.changeValuationInput();var o=this.staticPanel.children();if(this.bindStaticPanelChildrenEvent(o),this.calculateStyle(),"building"==e?this.linkageInput.attr("data-span","unit"):"unit"==e&&this.linkageInput.attr("data-span","house"),"house"==e)return a.getHouseInfo(this.getParams);this.getListData()},changeValuationInput:function(){var t="";this.staticPanel.children(".result-item").each(function(e,a){t+=$(a).attr("data-name")}),a.valuationInput.val(t),a.addNullStatus()},bindStaticPanelChildrenEvent:function(t){var e=this;t.each(function(t,a){$(a).find("a").unbind("click").bind("click",function(t){e.isEcho=!1,e.spanParentNode=$(this).parent(),$("#result_"+e.spanParentNode.data().type).find("ul>li").show(),$("#"+$(this).data().type).toggle().siblings(".menu-result").hide(),t.stopPropagation()}),$(a).find("span").unbind("click").bind("click",function(t){e.isEcho=!1,e.spanParentNode=$(this).parent(),$("#result_"+e.spanParentNode.attr("data-type")).find("ul>li").show(),e.spanParentNode.hide().nextAll(".result-item").hide(),$("#result_"+e.spanParentNode.attr("data-type")).show().siblings(".menu-result").hide(),e.linkageInput.attr("data-span",e.spanParentNode.attr("data-type")).val(e.spanParentNode.attr("data-name")).focus(),e.calculateStyle(),t.stopPropagation()})})},bindLinkageInputEvent:function(){var t=this;t.getParams={buildingName:"",buildingCode:"",unitName:"",unitCode:"",houseName:"",houseCode:""},t.clearParams=function(){return t.getParams.buildingName="",t.getParams.buildingCode="",t.getParams.unitName="",t.getParams.unitCode="",t.getParams.houseName="",t.getParams.houseCode="",t.getParams},t.getParams.comName=yf.param("housingName"),this.linkageInput.unbind("click").bind("click",function(){if(t.isEcho=!1,"house"==this.getAttribute("data-name"))return a.getHouseInfo(t.getParams);t.getListData()}),this.linkageInput.unbind("keyup").bind("keyup",function(t){var e=this.getAttribute("data-span"),a=yf.replaceHtml($(this).val()),i=$("#result_"+e).find("ul>li");""!=a?i.hide().filter("li:contains("+a+")").show():i.show()})},getListData:function(){var t=this;t.staticPanel.children().length>0&&(t.clearParams(),t.updataParams()),e.linkageBuilding(this.getParams).success(function(e){(e=e.data)&&e.list.length&&t.createDownTemplate(e.qtype,e.list)}).error(function(t){})},updataParams:function(){var t=this;return t.staticPanel.children().each(function(e,a){t.getParams[a.getAttribute("data-type")+"Name"]=a.getAttribute("data-name"),t.getParams[a.getAttribute("data-type")+"Code"]=a.getAttribute("data-id")}),t.getParams},calculateStyle:function(){var t=this,e=function(){t.keyBody.css({width:t.parentNode.width()-t.staticPanel.width()-1})};e(),$(window).resize(e)}}.init();return layui.use(["form","element"],function(){a.form=layui.form,a.element=layui.element,a.form.render("select"),a.form.on("select(wuyeleixing)",function(t){yf.priceTrend&&yf.priceTrend.main.trendInfo()}),setTimeout(function(){yf.scroll({elmId:".layui-anim",height:"auto"})},1e3),a.element.on("tab(houseReference)",function(e){t[$(e.elem).find("li.layui-this").data().module]()})}),yf.$params=function(){return{housingName:yf.param("housingName"),istrative:yf.param("istrative"),houseArea:a.oHouseArea.val()||"",estateType:a.oEstateType.val()||"",toward:a.oToward.val()||"",year:a.oYear.val()||"",floor:a.oFloor.val()||"",sumFloor:a.oSumFloor.val()||"",special:a.oSpecial.val(),valuationId:a.valuationId||"",jUnitPrice:a.jUnitPrice.text()||"",jTotalPrice:a.jTotalPrice.text()||"",buildingName:i.getParams.buildingName||"",buildingCode:i.getParams.buildingCode||"",unitName:i.getParams.unitName||"",unitCode:i.getParams.unitCode||"",houseName:i.getParams.houseName||"",houseCode:i.getParams.houseCode||""}}});