!function(e){function i(e,i,t){e>=100?(e+="%",t=t||"上传中......"):(e+="%",t=t||e);var a=i.find(".diyProgress"),n=i.find(".diyProgressText");a.width(e),n.text(t)}function t(e,i,t){t.removeFile(i),e.siblings("li").length<=0?e.parents(".parentFileBox").remove():e.remove()}function a(i,t){if(e("#"+i).siblings(".parentFileBox").find(".fileBoxUl li").length>1){var a=e("#"+i).siblings(".parentFileBox").find(".fileBoxUl li").eq(0).attr("id").split("fileBox_")[1];e("#"+i).siblings(".parentFileBox").find(".fileBoxUl li").eq(0).remove(),t.removeFile(a)}}function n(e){var i={};return i.xls="xls",i.xlsx="xls",(i=i[e]||"txt")+"_diy_bg"}e.fn.extend({diyUpload:function(l,d){if("object"==typeof l){var r=e(this),o=r.attr("id");if(l.url&&(l.server=l.url,delete l.url),l.success){var s=l.success;delete l.success}if(l.error){var c=l.error;delete l.error}e.each(function(e){return{swf:"/src/content/js/third/webUpload/Uploader.swf",pick:{id:e,label:"点击选择图片"},accept:{title:"Images",extensions:"gif,jpg,jpeg,bmp,png",mimeTypes:"image/bmp,image/jpg,image/jpeg,image/png"},thumb:{width:110,height:99,quality:70,allowMagnify:!1,crop:!0,type:"image/jpeg"},method:"POST",server:"",sendAsBinary:!1,chunked:!1,chunkSize:524288,fileNumLimit:50,fileSizeLimit:209715200,fileSingleSizeLimit:5242880}}("#"+o),function(e,i){l[e]=l[e]||i}),l.buttonText&&(l.pick.label=l.buttonText,delete l.buttonText);var f=function(i){if(WebUploader.Uploader.support())return new WebUploader.Uploader(i);e("#isSupport").removeClass("hide")}(l);if(f){f.on("beforeFileQueued",function(i){if(e("#"+o).siblings(".parentFileBox").find("ul li").length>=2)return layer.msg("图片上传超过限制"),!1}),f.on("fileQueued",function(i){!function(i,l,d,r){var o=l.id,s=i.next(".parentFileBox");s.length<=0&&(c='<div class="parentFileBox"> \t\t\t\t\t\t<ul class="fileBoxUl"></ul>\t\t\t\t\t</div>',i.after(c),s=i.next(".parentFileBox"));if(s.find(".diyButton").length<=0){var c='<div class="diyButton"> \t\t\t\t\t\t<a class="diyCancelAll" href="javascript:void(0)">全部取消</a> \t\t\t\t\t\t<a class="diyStart" href="javascript:void(0)">开始上传</a> \t\t\t\t\t</div>';s.append(c);var f=s.find(".diyStart"),u=s.find(".diyCancelAll");f.one("click",function(){d.upload()}),u.bind("click",function(){var i=d.getFiles("queued");e.each(i,function(i,a){t(e("#fileBox_"+a.id),a.id,d)})})}e(".diyButton").hide();var p='<li id="fileBox_'+o+'" class="diyUploadHover" data-reup="true"> \t\t\t\t\t<div class="viewThumb"></div> \t\t\t\t\t<div class="diyCancel"></div> \t\t\t\t\t<div class="diySuccess"></div> \t\t\t\t\t<div class="diyFileName">'+l.name+'</div>\t\t\t\t\t<div class="diyBar"> \t\t\t\t\t\t\t<div class="diyProgress"></div> \t\t\t\t\t\t\t<div class="diyProgressText">0%</div> \t\t\t\t\t</div> \t\t\t\t</li>';s.children(".fileBoxUl").append(p),a("chooseHead",d),a("chooseJrcode",d),a("license",d),a("credit",d);var v=s.find("#fileBox_"+o);if(v.children(".diyCancel").one("click",function(){t(e(this).parent("li"),o,d)}),"image"==l.type.split("/")[0])d.makeThumb(l,function(e,i){e||v.find(".viewThumb").append('<img src="'+i+'" >')});else{var m=n(l.name.split(".").pop());n(l.name.split(".")[1]),v.addClass(m)}}(r,i,f)}),f.on("uploadProgress",function(t,a){var n=e("#fileBox_"+t.id).find(".diyBar");n.show(),i((a*=100).toFixed(2),n)}),f.on("uploadFinished",function(){r.next(".parentFileBox").children(".diyButton").remove()}),f.on("uploadAccept",function(e,i){d&&d(i)});var u="";f.on("uploadSuccess",function(i,t){var a=e("#fileBox_"+i.id),n=a.find(".diyBar");a.removeClass("diyUploadHover"),200==t.code?(u=t.data.fileName,a.removeAttr("data-reup"),e(a).attr("data-fileName",t.data.fileName),e(a).attr("data-valid",t.data.isThisUpload),n.fadeOut(1e3,function(){a.children(".diyCancel").hide(),a.children(".diySuccess").show()}),s&&s(t)):layer.msg("登录过期，请重新登录")}),f.on("uploadBeforeSend",function(e,i){}),f.on("uploadError",function(t,a){i(0,e("#fileBox_"+t.id).find(".diyBar"),"上传失败!");var n="上传失败! 文件:"+t.name+" 错误码:"+a;c&&c(n)}),f.on("error",function(e){var i="";switch(e){case"F_DUPLICATE":i="该文件已经被选择了!";break;case"Q_EXCEED_NUM_LIMIT":i="上传文件数量超过限制!";break;case"F_EXCEED_SIZE":i="文件大小超过限制!";break;case"Q_EXCEED_SIZE_LIMIT":i="所有文件总大小超过限制!";break;case"Q_TYPE_DENIED":i="文件类型不正确或者是空文件!";break;default:i="未知错误!"}layer.msg(i)})}}else alert("参数错误!")}})}(jQuery);