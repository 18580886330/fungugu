require(["src/user/valuationRecord/js/valuationRecord-f4a83779eb.server.js"],function(t){"use strict";({data:{},init:function(){return this.startDate="",this.endDate="",this.resTabelFn(),this.searchFn(),this.resetFn(),this.dateInitFn(),this.exportListFn(),this.areaDisPoseFn(),this.gainMechanisms(),layer.closeAll(),yf.scroll({elmId:"#his_evaluate"}),this},detailFN:function(t){var a=$("#details_popup");layer.open({type:1,title:!1,area:["auto","auto"],closeBtn:!1,shadeClose:!1,resize:!1,content:a,success:function(){$("#market_unit_price").text(yf.filterStr(t.shiChangDanJia)),$("#market_total_price").text(yf.filterStr(t.shiChangZongJia)),$("#evaluate_unit_price").text(yf.filterStr(t.diYaDanJia)),$("#evaluate_total_price").text(yf.filterStr(t.diYaZongJia)),$("#gu_time").text(yf.filterStr(t.xunJiaShiJian)),$("#village_addr").val(yf.filterStr(t.xiaoQuDiZhi)),$("#village_name").val(yf.filterStr(t.xiaoQuMingCheng)),$("#village_city").val(yf.filterStr(t.chengShi)),$("#village_district").val(yf.filterStr(t.xingZhengQu)),$("#village_zone").val(yf.filterStr(t.pianQu)),$("#village_building").val(yf.filterStr(t.louZhuangHao)),$("#village_unit").val(yf.filterStr(t.danYuanHao)),$("#village_code").val(yf.filterStr(t.huHao)),$("#village_area").val(yf.filterStr(t.mianJi)+"㎡"),$("#village_floor").val("所在"+yf.filterStr(t.suoZaiLouCeng)+"层  共"+yf.filterStr(t.zongLouCeng)+"层"),$("#village_direction").val(yf.filterStr(t.chaoXiang)),$("#village_year").val(yf.filterStr(t.jianChengNianDai)),$("#village_estates").val(yf.filterStr(t.wuYeLeiXing)),$("#village_specil").val(yf.filterStr(t.teShuYinSu)),$("#village_benchmark").val(yf.filterStr(t.xiaoQuJiZhunJia))},end:function(){a.hide()}})},resTabelFn:function(a){var e=this,i=$("#valuation_organ").siblings(".layui-form-select").find(".layui-anim-upbit").find(".layui-this").attr("lay-value"),n={city:yf.replaceHtml($("#local_city").val()),comName:yf.replaceHtml($("#com_name").val()),areaMin:$("#min_area").val(),areaMax:$("#max_area").val(),dateMin:yf.replaceHtml($("#begin_date").val()),dateMax:yf.replaceHtml($("#end_date").val()),pageNo:a||1,pageSize:10,userId:i};"全部"==i&&(n.userId="");var l=layer.load(2,{shade:[.1,"#000"]});t.getTableList(n).success(function(t){if(layer.close(l),200==t.code){var a="";if(t.data.list.length>0){$("#detail_export").removeClass("layui-btn-disabled");for(var i=0;i<t.data.list.length;i++)a+='<tr>\t\t\t\t\t\t\t\t <td width="80" class="text-center">'+yf.filterStr(t.data.list[i].chengShi)+'</td>\t\t\t\t\t\t\t\t <td width="260">\t\t\t\t\t\t\t\t\t <p>'+yf.filterStr(t.data.list[i].xiaoQuMingCheng)+"</p>\t\t\t\t\t\t\t\t\t <p>"+yf.filterStr(t.data.list[i].xunJiaShiJian)+'</p>\t\t\t\t\t\t\t\t </td>\t\t\t\t\t\t\t\t <td width="160">\t\t\t\t\t\t\t\t\t <p>总价：<span class="c-red">'+yf.filterStr(t.data.list[i].shiChangZongJia)+'</span>万元</p>\t\t\t\t\t\t\t\t\t <p>单价：<span class="c-red">'+yf.filterStr(t.data.list[i].shiChangDanJia)+'</span>元/㎡</p>\t\t\t\t\t\t\t\t </td>\t\t\t\t\t\t\t\t <td width="120">\t\t\t\t\t\t\t\t\t <p>面积：<span class="c-red">'+yf.filterStr(t.data.list[i].mianJi)+"</span>㎡</p>\t\t\t\t\t\t\t\t\t <p>朝向：<span>"+yf.filterStr(t.data.list[i].chaoXiang)+'</span></p>\t\t\t\t\t\t\t\t </td>\t\t\t\t\t\t\t\t <td width="120">\t\t\t\t\t\t\t\t\t <p>总楼层：'+yf.filterStr(t.data.list[i].zongLouCeng)+"层</p>\t\t\t\t\t\t\t\t\t <p>所在层："+yf.filterStr(t.data.list[i].suoZaiLouCeng)+'层</p>\t\t\t\t\t\t\t\t </td>\t\t\t\t\t\t\t\t <td width="80">\t\t\t\t\t\t\t\t\t <a class="c-blue" href="javascript:" data-id="'+t.data.list[i].id+'">查看详情</a>\t\t\t\t\t\t\t\t </td>\t\t\t\t\t\t\t </tr>';$("#his_detatil").html(a),$("#his_detatil tr:odd").css("background","#f9f9f9"),e.detailsFn(),e.pageFn("queryLogsPage",t.data.pageNum,t.data.total,"resTabelFn")}else $("#his_detatil").html('<tr class="text-center"><td colspan="6">暂无数据</td></tr>'),$("#detail_export").addClass("layui-btn-disabled")}else $("#queryLogsPage").html(""),$("#his_detatil").html('<tr class="text-center"><td colspan="6">暂无数据</td></tr>'),$("#detail_export").addClass("layui-btn-disabled")}).error(function(){layer.close(l)})},detailsFn:function(){var a=this;$("#his_detatil tr td").find("a").unbind("click").bind("click",function(){var e=$(this).attr("data-id"),i=layer.load(2,{shade:[.1,"#000"]});t.getLocalRecord(e).success(function(t){yf.msg(t)?200==t.code&&(a.detailFN(t.data),layer.close(i)):layer.close(i)}).error(function(){})})},searchFn:function(){var t=this,a=/[~#^$@%&！!*]/;$("#detail_search").click(function(){var e=!0,i=!0,n=$("#min_area").val(),l=$("#max_area").val();""!=$("#com_name").val()&&a.test($("#com_name").val())?layer.tips("估值对象不能有特殊符号","#com_name",{tips:[2,"#666"]}):""!=$("#local_city").val()&&a.test($("#local_city").val())?layer.tips("城市不能有特殊符号","#local_city",{tips:[2,"#666"]}):(""!=n&&(e=t.limitAreaFn("#min_area")),""!=l&&(i=t.limitAreaFn("#max_area")),e&&i&&(""!=n&&""!=l&&Number(n)>Number(l)&&($("#min_area").val(l),$("#max_area").val(n)),t.resTabelFn()))})},resetFn:function(){var t=this;$("#detail_reset").click(function(){"全部"==$("#valuation_organ").siblings(".layui-form-select").find(".layui-anim-upbit").find(".layui-this").attr("lay-value")&&""==$("#begin_date").val()&&""==$("#end_date").val()&&""==$("#min_area").val()&&""==$("#max_area").val()&&""==$("#com_name").val()&&""==$("#local_city").val()||($("#detail_record").find("input").val(""),t.endDate.config.min.year=t.startDate.config.min.year,t.endDate.config.min.month=t.startDate.config.min.month,t.endDate.config.min.date=t.startDate.config.min.date,t.startDate.config.max.year=t.endDate.config.max.year,t.startDate.config.max.month=t.endDate.config.max.month,t.startDate.config.max.date=t.endDate.config.max.date,$("#valuation_organ").find("option[value='全部']").attr("selected","selected"),t.form.render("select"),t.resTabelFn(),yf.placeholder())})},pageFn:function(t,a,e,i){var n=this;this.layPage?n.page(t,a,e,i):layui.use(["laypage","form"],function(){n.layPage=layui.laypage,n.form=layui.form,n.form.render("select"),n.page(t,a,e,i)})},page:function(t,a,e,i){var n=this;this.layPage.render({elem:t,curr:a||1,count:e,limit:10,layout:["prev","page","next","skip","count"],jump:function(t,a){a||n[i](t.curr)}})},dateInitFn:function(){var t=this;layui.use(["laydate"],function(){t.startDate=layui.laydate.render({elem:"#begin_date",max:0,done:function(a,e){""!==a?(t.endDate.config.min.year=e.year,t.endDate.config.min.month=e.month-1,t.endDate.config.min.date=e.date):(t.endDate.config.min.year=t.startDate.config.min.year,t.endDate.config.min.month=t.startDate.config.min.month,t.endDate.config.min.date=t.startDate.config.min.date)}}),t.endDate=layui.laydate.render({elem:"#end_date",max:0,done:function(a,e){""!==a?(t.startDate.config.max.year=e.year,t.startDate.config.max.month=e.month-1,t.startDate.config.max.date=e.date):(t.startDate.config.max.year=t.endDate.config.max.year,t.startDate.config.max.month=t.endDate.config.max.month,t.startDate.config.max.date=t.endDate.config.max.date)}})})},exportListFn:function(){$("#detail_export").unbind("click").bind("click",function(){if(!$("#detail_export").hasClass("layui-btn-disabled")){var a=$("#valuation_organ").siblings(".layui-form-select").find(".layui-anim-upbit").find(".layui-this").attr("lay-value"),e={city:yf.replaceHtml($("#local_city").val()),comName:yf.replaceHtml($("#com_name").val()),areaMin:$("#min_area").val(),areaMax:$("#max_area").val(),dateMin:yf.replaceHtml($("#begin_date").val()),dateMax:yf.replaceHtml($("#end_date").val()),userId:a};"全部"==e.userId&&(e.userId="");var i=layer.load(2,{shade:[.1,"#000"]});t.getExcelExport(e).success(function(t){yf.msg(t)?"200"==t.code&&(layer.close(i),$("#exportDownload").attr("href",t.data),layer.open({type:"1",title:!1,closeBtn:!1,shadeClose:!1,resize:!1,area:["auto","auto"],content:$("#exportDownPop"),success:function(){$("#exportDownload").off("click").click(function(){layer.closeAll(),layer.msg("导出成功")})},end:function(){$("#exportDownPop").hide()}})):layer.close(i)}).error(function(t){})}})},areaDisPoseFn:function(){var t=this;$("#min_area").keyup(function(){t.limitAreaFn("#min_area")}),$("#max_area").keyup(function(){t.limitAreaFn("#max_area")})},limitAreaFn:function(t){var a=$(t).val().replace(/\s+/g,""),e=!0;return""==a?e:!/^(([1-9]\d{0,3}(\.\d{0,2})?)|9999)$/.test(a)||a>9998.99?($(t).val(a.length>=4?a.substr(0,4):a.substr(a.length-1)),layer.tips("请输入面积为1~9998.99，只留两位小数！",t,{tips:[2,"#666"]}),e=!1):e},gainMechanisms:function(a){var e=this,i='<option value="全部">全部</option>';t.getMechanisms({moduleName:"询价记录关联"}).success(function(t){if(t.success){if("--"!=yf.filterStr(t.data.organizationName)&&(i+='<option value="'+t.data.userId+'">'+t.data.organizationName+"</option>"),t.data.subordinateRelation.length>0)for(var a=0;a<t.data.subordinateRelation.length;a++)i+='<option value="'+t.data.subordinateRelation[a].SubaccountId+'">'+t.data.subordinateRelation[a].keHuDanWei+"</option>";$("#valuation_organ").html(i),layui.use(["form"],function(){e.form=layui.form,e.form.render("select")})}else $("#valuation_organ").html(i),$("#valuation_organ").attr("disabled","disabled"),$("#valuation_organ").removeAttr("lay-search"),layui.use(["form"],function(){e.form=layui.form,e.form.render("select")})})}}).init()});