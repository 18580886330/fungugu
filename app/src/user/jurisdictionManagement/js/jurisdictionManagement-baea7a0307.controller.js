require(["src/user/jurisdictionManagement/js/jurisdictionManagement-5bc3ad530a.server.js"],function(t){"use strict";({init:function(){this.mechDataArr=[],this.subCityDataArr=[],this.numReg=/^(100|\d{0,2}|\d)$/,this.rateReg=/^([1-9]\d?|100)$/,this.gainMechanisms("全部",null,"#jurdt_outfit","#jurdt_subCity"),this.showBatchFn(),this.showTableFn()},showBatchFn:function(){var i=this,e=1;$("#go_batch").click(function(){layer.open({type:1,title:!1,area:["auto","auto"],closeBtn:!1,shadeClose:!1,resize:!1,content:$("#batch_setup"),success:function(){i.gainMechanisms("全部",null,"#batch_pop_outfit","#batch_pop_subCity"),i.gainSubCity("全部",null,"#batch_pop_subCity","#batch_pop_outfit"),1!=e&&($("#batch_pop_type").find("option[value='0']").attr("selected","selected"),i.form.render("select")),e++,$("#batch_pop_discount").val(""),$("#batch_pop_mortgage").val(""),$("#batch_pop_cancle").off("click").click(function(){layer.closeAll()}),$("#batch_pop_conserve").off("click").click(function(){var e=$("#batch_pop_outfit").siblings(".layui-form-select").find(".layui-anim-upbit").find(".layui-this").attr("lay-value"),a=$("#batch_pop_subCity").siblings(".layui-form-select").find(".layui-anim-upbit").find(".layui-this").attr("lay-value"),s=$("#batch_pop_type").siblings(".layui-form-select").find(".layui-anim-upbit").find(".layui-this").attr("lay-value"),n=$("#batch_pop_discount"),l=$("#batch_pop_mortgage");if(""==n.val()||i.numReg.test(n.val()))if(""==l.val()||i.rateReg.test(l.val())){"全部"==e&&(e=""),"全部"==a&&(a="");var u={userId:e,selectCity:a,mortgageRate:l.val(),discountRate:n.val(),priceTypeDefault:s};l.val()&&(u.mortgageRate=(l.val()/100).toFixed(2)),n.val()&&(u.discountRate=(n.val()/100).toFixed(2)),yf.loading("#batch_setup_main"),t.getBatchSetUp(u).success(function(t){yf.removeLoading("#batch_setup_main"),t.success&&(layer.closeAll(),layer.msg(t.msg),i.showTableFn())})}else layer.tips("抵押率只能为1-100之间的整数",l,{tips:[2,"#666"]});else layer.tips("放款折扣只能为0-100之间的整数",n,{tips:[2,"#666"]})})},end:function(){$("#batch_setup").hide(),yf.removeLoading("#batch_setup_main"),setTimeout(function(){i.glorifyFn("#jurdt_outfit"),i.glorifyFn("#jurdt_subCity")},100)}})})},gainMechanisms:function(i,e,a,s){var n={moduleName:"抵押比率关联",selectCity:i||""};"全部"==i&&(n.selectCity="");var l=this,u='<option value="全部">全部</option>';if(this.mechDataArr.length>0)for(var r=0;r<this.mechDataArr.length;r++)if(i==this.mechDataArr[r].subCity){for(var o=0;o<this.mechDataArr[r].mechArr.length;o++)u+='<option value="'+this.mechDataArr[r].mechArr[o].userId+'">'+this.mechDataArr[r].mechArr[o].mechName+"</option>";return"#jurdt_outfit"==a?($("#jurdt_outfit").html(u),e&&$("#jurdt_outfit").find("option[value='"+e+"']").attr("selected","selected")):($("#batch_pop_outfit").html(u),e&&$("#batch_pop_outfit").find("option[value='"+e+"']").attr("selected","selected")),l.form.render("select"),void setTimeout(function(){l.glorifyFn(a)},100)}t.getMechanisms(n).success(function(t){if(t.success){var n='<option value="全部">全部</option>',u={subCity:"",mechArr:[]};if("--"!=yf.filterStr(t.data.organizationName)&&(n+='<option value="'+t.data.userId+'">'+t.data.organizationName+"</option>",u.mechArr.push({userId:t.data.userId,mechName:t.data.organizationName})),t.data.subordinateRelation.length>0)for(var r=0;r<t.data.subordinateRelation.length;r++)n+='<option value="'+t.data.subordinateRelation[r].SubaccountId+'">'+t.data.subordinateRelation[r].keHuDanWei+"</option>",u.mechArr.push({userId:t.data.subordinateRelation[r].SubaccountId,mechName:t.data.subordinateRelation[r].keHuDanWei});"#batch_pop_outfit"!=a?($(a).html(n),e&&$(a).find("option[value='"+e+"']").attr("selected","selected")):($("#batch_pop_outfit").html(n),e&&$(a).find("option[value='"+e+"']").attr("selected","selected")),layui.use(["form"],function(){l.form=layui.form,l.form.render("select"),setTimeout(function(){l.glorifyFn(a)},100),"全部"==i&&l.gainSubCity("全部",null,s,a),l.form.on("select(jurdtName)",function(t){var i=$("#jurdt_subCity").siblings(".layui-form-select").find(".layui-anim-upbit").find(".layui-this").text();l.gainSubCity(t.value,i,"#jurdt_subCity","#jurdt_outfit"),l.showTableFn(),setTimeout(function(){l.glorifyFn("#jurdt_outfit")},100)}),l.form.on("select(batchPop-outfit)",function(t){var i=$("#batch_pop_subCity").siblings(".layui-form-select").find(".layui-anim-upbit").find(".layui-this").text();l.gainSubCity(t.value,i,"#batch_pop_subCity","#batch_pop_outfit"),setTimeout(function(){l.glorifyFn("#batch_pop_outfit")},100)})}),u.subCity=i,l.mechDataArr.push(u)}})},gainSubCity:function(i,e,a,s){var n={moduleName:"抵押比率关联",subUserId:i};"全部"==i&&(n.subUserId="");var l=this,u='<option value="全部">全部</option>';if(this.subCityDataArr.length>0)for(var r=0;r<this.subCityDataArr.length;r++)if(i==this.subCityDataArr[r].mecId){for(var o=0;o<this.subCityDataArr[r].subCity.length;o++)u+='<option value="'+this.subCityDataArr[r].subCity[o]+'">'+this.subCityDataArr[r].subCity[o]+"</option>";return"#jurdt_subCity"==a?($("#jurdt_subCity").html(u),e&&$("#jurdt_subCity").find("option[value='"+e+"']").attr("selected",!0)):($("#batch_pop_subCity").html(u),e&&$(a).find("option[value='"+e+"']").attr("selected",!0)),l.form.render("select"),void setTimeout(function(){l.glorifyFn(a)},100)}t.getsubordinateCity(n).success(function(t){if(t.success){var s='<option value="全部">全部</option>',n={mecId:"",subCity:[]};if(t.data.length>0)for(var u=0;u<t.data.length;u++)s+='<option value="'+t.data[u].ChengShiMingCheng+'">'+t.data[u].ChengShiMingCheng+"</option>",n.subCity.push(t.data[u].ChengShiMingCheng);"#batch_pop_subCity"!=a?($(a).html(s),e&&$(a).find("option[value='"+e+"']").attr("selected",!0)):($("#batch_pop_subCity").html(s),e&&$(a).find("option[value='"+e+"']").attr("selected",!0)),l.form.render("select"),setTimeout(function(){l.glorifyFn(a)},100);$(a).attr("lay-filter");l.form.on("select(subCity)",function(t){var i=$("#jurdt_outfit").siblings(".layui-form-select").find(".layui-anim-upbit").find(".layui-this").attr("lay-value");l.gainMechanisms(t.value,i,"#jurdt_outfit","#jurdt_subCity"),l.showTableFn(),setTimeout(function(){l.glorifyFn("#jurdt_subCity")},100)}),l.form.on("select(batchPop-subCity)",function(t){var i=$("#batch_pop_outfit").siblings(".layui-form-select").find(".layui-anim-upbit").find(".layui-this").attr("lay-value");l.gainMechanisms(t.value,i,"#batch_pop_outfit","#batch_pop_subCity"),setTimeout(function(){l.glorifyFn("#batch_pop_subCity")},100)}),n.mecId=i,l.subCityDataArr.push(n)}})},showTableFn:function(i){var e=$("#jurdt_outfit").siblings(".layui-form-select").find(".layui-anim-upbit").find(".layui-this").attr("lay-value"),a=$("#jurdt_subCity").siblings(".layui-form-select").find(".layui-anim-upbit").find(".layui-this").attr("lay-value"),s={userId:e,selectCity:a,pageNo:i||1,pageSize:10},n=this,l=layer.load(2,{shade:[.1,"#000"]});"全部"==e&&(s.userId=""),"全部"==a&&(s.selectCity=""),t.getJurisdictionList(s).success(function(t){if(layer.close(l),t.success)if(t.data.list.length>0){for(var i="",e=0;e<t.data.list.length;e++){var a=JSON.stringify(t.data.list[e]).replace(" ","");i+='<tr>\t\t\t\t\t\t\t\t<td width="180">'+yf.filterStr(t.data.list[e].KeHuDanWei)+'</td>\t\t\t\t\t\t\t\t<td width="80">'+yf.filterStr(t.data.list[e].ChengShiMingCheng)+'</td>\t\t\t\t\t\t\t\t<td width="40">\t\t\t\t\t\t\t\t\t<div class="layui-form-item">\t\t\t\t\t\t\t\t\t\t<label class="layui-form-label">自设抵押率：</label>\t\t\t\t\t\t\t\t\t\t<div class="layui-input-block">\t\t\t\t\t\t\t\t\t\t\t<p class="authority-reveal">'+(100*t.data.list[e].DiYaJiaGeChengShu).toFixed(0)+'%</p>\t\t\t\t\t\t\t\t\t\t\t<input type="text" class="layui-input text-center hide" value="'+(100*t.data.list[e].DiYaJiaGeChengShu).toFixed(0)+'" maxLength="3"/>\t\t\t\t\t\t\t\t\t\t\t<span class="authority-unit hide">%</span>\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t<td width="40">\t\t\t\t\t\t\t\t\t<div class="layui-form-item">\t\t\t\t\t\t\t\t\t\t<label class="layui-form-label">放款折扣：</label>\t\t\t\t\t\t\t\t\t\t<div class="layui-input-block">\t\t\t\t\t\t\t\t\t\t\t<p class="authority-reveal">'+(100*t.data.list[e].FangDaiZheKouChengShu).toFixed(0)+'%</p>\t\t\t\t\t\t\t\t\t\t\t<input type="text" class="layui-input text-center hide" value="'+(100*t.data.list[e].FangDaiZheKouChengShu).toFixed(0)+'" maxLength="3"/>\t\t\t\t\t\t\t\t\t\t\t<span class="authority-unit hide">%</span>\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t<td width="220">\t\t\t\t\t\t\t\t\t<div class="layui-form-item">\t\t\t\t\t\t\t\t\t\t<label class="layui-form-label">结果展示：</label>\t\t\t\t\t\t\t\t\t\t<div class="layui-input-block">\t\t\t\t\t\t\t\t\t\t\t<p class="authority-reveal" data-type="'+t.data.list[e].GuJiaZhanShiLeiXing+'">'+yf.priceTypeShow[t.data.list[e].GuJiaZhanShiLeiXing]+'</p>\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t<td class="text-center"  width="100">\t\t\t\t\t\t\t\t\t<a class="c-blue hide keep" href="javascript:;">保存</a>\t\t\t\t\t\t\t\t\t<a class="c-blue hide cancel" href="javascript:;">取消</a>\t\t\t\t\t\t\t\t\t<a class="c-blue edit" href="javascript:;" data-record='+a+">设置</a>\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t</tr>"}$("#jurdtTable").html(i),$("#jurdtTable tr:odd").css("background","#f9f9f9"),n.pageFn("jurdtPages",t.data.pageNum,t.data.total,"showTableFn"),n.setUpFn()}else $("#jurdtPages").html(""),$("#jurdtTable").html('<tr class="text-center"><td colspan="6">暂无数据</td></tr>');else layer.msg(t)})},setUpFn:function(){var t=this;$("#jurdtTable").find(".edit").off("click").click(function(){var i=$(this).parents("tr").find(".authority-reveal").eq(0),e=$(this).parents("tr").find(".authority-reveal").eq(1),a=$(this).parents("tr").find(".authority-reveal").eq(2),s=a.attr("data-type"),n=$(this).attr("data-record");$(this).hide(),$(this).parent().find("a").removeClass("hide"),$(this).parents("tr").find(".authority-reveal").hide(),$(this).parents("tr").find(".authority-reveal").next().removeClass("hide"),$(this).parents("tr").find(".authority-unit").removeClass("hide"),i.next("input").val(i.text().split("%")[0]),e.next("input").val(e.text().split("%")[0]),a.after('<select>\t\t\t\t\t\t\t <option value="0">市场评估价</option>\t\t\t\t\t\t\t <option value="1">抵押评估价</option>\t\t\t\t\t\t\t <option value="2">自定义抵押评估价</option>\t\t\t\t\t\t \t<select>'),a.siblings("select").val(s),t.form.render("select"),setTimeout(function(){t.glorifyFn("#jurdt_outfit"),t.glorifyFn("#jurdt_subCity")},100),t.conserveFn($(this).siblings(".keep"),n),t.cancelFn($(this).siblings(".cancel"))})},conserveFn:function(i,e){var e=JSON.parse(e),a=this;i.off("click").click(function(){var s=i.parents("tr").find(".authority-reveal").eq(0),n=s.siblings("input"),l=i.parents("tr").find(".authority-reveal").eq(1),u=l.siblings("input"),r=i.parents("tr").find(".authority-reveal").eq(2),o=r.siblings(".layui-form-select").find(".layui-anim-upbit").find(".layui-this").attr("lay-value");if(""!=n.val()&&""!=$.trim(n.val()))if(a.rateReg.test(n.val()))if(""==u.val()||a.numReg.test(u.val()))if(s.text().split("%")[0]!=n.val()||l.text().split("%")[0]!=u.val()||r.attr("data-type")!=o){var c={recordId:e.id,selectCity:e.ChengShiMingCheng,mortgageRate:(n.val()/100).toFixed(2),discountRate:(u.val()/100).toFixed(2)||"0",priceTypeDefault:o};t.getAmend(c).success(function(t){t.success?(layer.msg(t.msg),a.showTableFn()):layer.msg(t.msg)})}else $(this).siblings(".cancel").trigger("click");else layer.tips("放款折扣只能为0-100之间的整数",u,{tips:[1,"#666"]});else layer.tips("抵押率只能为1-100之间的整数",n,{tips:[1,"#666"]});else layer.tips("请输入自设抵押率",n,{tips:[1,"#666"]})})},cancelFn:function(t){t.off("click").click(function(){t.addClass("hide"),t.siblings(".keep").addClass("hide"),t.siblings(".edit").show(),t.parents("tr").find(".authority-reveal").show(),t.parents("tr").find(".authority-reveal").next().addClass("hide"),t.parents("tr").find(".authority-reveal").eq(2).nextAll().remove(),t.parents("tr").find(".authority-unit").addClass("hide")})},pageFn:function(t,i,e,a){var s=this;this.layPage?s.page(t,i,e,a):layui.use(["laypage"],function(){s.layPage=layui.laypage,s.page(t,i,e,a)})},page:function(t,i,e,a){var s=this;this.layPage.render({elem:t,curr:i||1,count:e,limit:10,layout:["prev","page","next","count"],jump:function(t,i){i||s[a](t.curr)}})},glorifyFn:function(t){var i=$(t).siblings(".layui-unselect").find(".layui-anim");yf.scroll({elmId:i,height:"auto"})}}).init()});