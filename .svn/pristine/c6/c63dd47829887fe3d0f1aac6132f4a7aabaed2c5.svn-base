require(["src/components/surroundingFacility/js/surroundingFacility-a569bc06c9.server.js"],function(t){"use strict";({init:function(){this.rimMap,this.detailMap,this.coordinate={},this.changeMapFn(),this.initMapFn(),this.obtainLocationFn(),this.searchDetailFn(),yf.scroll({elmId:"#result_grounbs",height:"270px"})},initMapFn:function(){this.retractFn("#basic_facts"),this.retractFn("#detail_facts"),this.rimMap=new AMap.Map("rimMap",{resizeEnable:!0}),$("#peripheralFactss,#peripheralDetails").hover(function(){yf.stopMainScroll()},function(){yf.updateMainScroll()})},retractFn:function(t){$(t).find(".switch-btn").off("click").click(function(){"收起"==$(this).text()?($(this).text("展开"),$(t).stop(!0,!1).animate({right:"-34%"},500)):($(this).text("收起"),$(t).stop(!0,!1).animate({right:"0px"},500))})},obtainLocationFn:function(){var a=this,i={districtName:yf.$params().istrative,comName:yf.$params().housingName};yf.loading("#peripheralFactss"),t.getComLocation(i).success(function(t){if(200!=t.code)return $("#basisc_transit,#basisc_rail,#basisc_medical,#basisc_educate").text("暂无数据"),void yf.removeLoading("#peripheralFactss");a.coordinate={longitude:t.data.xAmap,latitude:t.data.yAmap},new AMap.Marker({position:[t.data.xAmap,t.data.yAmap],map:a.rimMap}),a.rimMap.setFitView(),a.obtainInfoFn(a.coordinate),a.surDetailFn("公交",t.data.xAmap,t.data.yAmap)})},obtainInfoFn:function(a){var i=this;t.getSurvey(a).success(function(t){yf.removeLoading("#peripheralFactss"),200==t.code?(i.loopDataFn("#basisc_transit",t.data.busStop),i.loopDataFn("#basisc_rail",t.data.metroStation),i.loopDataFn("#basisc_medical",t.data.hospital),i.loopDataFn("#basisc_educate",t.data.school)):$("#basisc_transit,#basisc_rail,#basisc_medical,#basisc_educate").text("暂无数据")})},loopDataFn:function(t,a){if(a.length){for(var i="",e=3*Math.ceil($(t).width()/12),n=0;n<a.length;n++)i+=a[n].name+";";$(t).attr("title",i),i.length>e?$(t).html(i.substring(0,e)+"..."):$(t).html(i)}},changeMapFn:function(){$("#surf_map_btn").click(function(){"查看周边详情"==$(this).text()?($(this).text("返回周边概况"),$("#surf_caption").text("小区周边详情"),$("#peripheralFactss").hide()):($(this).text("查看周边详情"),$("#surf_caption").text("小区周边概况"),$("#peripheralFactss").show())})},surDetailFn:function(t){var a=this;this.detailMap=new AMap.Map("detailMap",{resizeEnable:!0}),AMap.service(["AMap.PlaceSearch"],function(){new AMap.PlaceSearch({pageSize:5,type:t,pageIndex:1,map:a.detailMap,panel:"result_gather"}).searchNearBy("",[a.coordinate.longitude,a.coordinate.latitude],1e3,function(t,a){})})},searchDetailFn:function(){var t=this,a=$("#detailMenu").find(".item");$("#result_come").html(yf.$params().housingName+"周边配套"),a.each(function(a,i){$(i).on("click",function(){var a=$(this).find("a>p.name").text();t.surDetailFn(a),t.showReaultFn()})})},showReaultFn:function(){$("#result_map").css("right","0"),$("#back_map_result").off("click").click(function(){$("#result_map").css("right","-100%")})}}).init()});