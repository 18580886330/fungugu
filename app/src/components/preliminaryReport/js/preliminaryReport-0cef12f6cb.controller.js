require(["src/components/preliminaryReport/js/preliminaryReport-8395d8f704.server.js"],function(server){var main={init:function(){this.picNum=0,this.reportParams={},this.picArr=[],this.form,yf.loadFile("src/content/js/third/ajaxfileupload/ajaxfileupload-b9d065a144.js"),this.showReportInfoFn(),this.gainDataFn(),this.pageShowDataFn()},showReportInfoFn:function(){var t=this;this.previewPicFn(),this.preauditReport=$("#preaudit_report"),this.thumb=this.preauditReport.find(".thumb"),this.reportContent=this.preauditReport.find(".report-content"),layer.open({area:["auto","auto"],type:1,closeBtn:!1,title:!1,shade:[.6,"#000"],resize:!1,content:t.preauditReport,success:function(){t.seeMoreFn(),t.isMakePreviewRepFn(),t.preauditReport.find("input").focus(function(){$(this).css("borderColor","#e6e6e6"),$(this).parent().hasClass("box-border")&&$(this).parent().css("borderColor","#e6e6e6")}),$("#rep_reset").off("click").click(function(){for(var e=t.preauditReport.find("select"),r=[],i=0;i<e.length;i++)r.push(e.eq(i).siblings(".layui-unselect").find("input").css("borderColor"));t.preauditReport.find("input").val(""),t.preauditReport.find("select").val(""),t.form.render("select");for(i=0;i<e.length;i++)e.eq(i).siblings(".layui-unselect").find("input").css("borderColor",r[i]);t.reportContent.find("input").click(function(){$(this).css("borderColor","#e6e6e6")}),t.picNum=0,t.reportParams={},t.thumb.children().remove(),t.thumb.attr("data-upload","true")})},end:function(){t.preauditReport.hide()}})},gainDataFn:function(){this.houseLocal=$("#rep_houseLocal"),this.area=$("#rep_area"),this.houseUse=$("#rep_houseUse"),this.housingProperty=$("#rep_housingProperty"),this.buildYear=$("#rep_buildYear"),this.curFloor=$("#rep_curFloor"),this.totalFloor=$("#rep_totalFloor"),this.exceptionalCase=$("#rep_exceptionalCase"),this.room=$("#rep_room"),this.hall=$("#rep_hall"),this.toilet=$("#rep_toilet"),this.toward=$("#rep_toward"),this.obligee=$("#rep_obligee"),this.taxation=$("#rep_taxation")},pageShowDataFn:function(){var t=$("#valuationRequire").find('select[name="special"]').html();this.exceptionalCase.html(t),this.houseLocal.val($("#valuationInput").val()),this.area.val(yf.$params().houseArea),this.houseUse.val(this.filterSelectStrFn(yf.$params().estateType)),this.buildYear.val(yf.$params().year),this.curFloor.val(yf.$params().floor),this.totalFloor.val(yf.$params().sumFloor),this.exceptionalCase.val(this.filterSelectStrFn(yf.$params().special)),this.toward.val(this.filterSelectStrFn(yf.$params().toward)),this.taxation.val(yf.taxationNum),this.autoScrollFn()},checkRuleFn:function(){var t=!0,e=(new Date).getFullYear();if(""==this.houseLocal.val()||""==$.trim(this.houseLocal.val()))return layer.msg("房屋坐落不能为空"),this.elemBlurFn(this.houseLocal),void(t=!1);if(/[~#^$@%&！!*]/.test(this.houseLocal.val()))return layer.msg("房屋坐落不能有特殊字符"),this.elemBlurFn(this.houseLocal),void(t=!1);if(this.houseLocal.val().length<2)return layer.msg("房屋坐落长度在2~100之间"),this.elemBlurFn(this.houseLocal),void(t=!1);if(""==this.area.val()||""==$.trim(this.area.val()))return layer.msg("面积不能为空"),this.elemBlurFn(this.area),void(t=!1);if(!/^[1-9]\d{0,3}(\.\d{0,2})?$/.test(this.area.val())||this.area.val()>9998.99)return layer.msg("请输入面积为1~9998.99，只留两位小数！"),this.elemBlurFn(this.area),void(t=!1);if(""!=this.buildYear.val()&&!/^\d{4}$/.test(this.buildYear.val()))return layer.msg("请输入年代为1900~"+e+"的四位整数！"),this.elemBlurFn(this.buildYear),void(t=!1);if(""!=this.buildYear.val()&&(this.buildYear.val()<1900||this.buildYear.val()>e))return layer.msg("请输入年代为1900~"+e+"的四位整数！"),this.elemBlurFn(this.buildYear),void(t=!1);if(""!=this.curFloor.val()&&!/^\d{1,2}$|-1$/.test(this.curFloor.val()))return layer.msg("所在楼层应该为-1或1~99！"),this.elemBlurFn(this.curFloor.parent()),void(t=!1);if(""!=this.curFloor.val()&&"0"==this.curFloor.val())return layer.msg("所在楼层应该为-1或1~99！"),this.elemBlurFn(this.curFloor.parent()),void(t=!1);if(""!=this.totalFloor.val()&&!/^\d{0,2}$/.test(this.totalFloor.val()))return layer.msg("总楼层应该为1~99！"),this.elemBlurFn(this.totalFloor.parent()),void(t=!1);if(""!=this.totalFloor.val()&&"0"==this.totalFloor.val())return layer.msg("总楼层应该为1~99！"),this.elemBlurFn(this.totalFloor.parent()),void(t=!1);if(""!=this.curFloor.val()&&""!=this.totalFloor.val()&&Number(this.curFloor.val())>Number(this.totalFloor.val()))return layer.msg("所在楼层不能大于总楼层！"),this.elemBlurFn(this.totalFloor.parent()),void(t=!1);if(""==this.room.val()||this.limitRoomFn(this.room))if(""==this.hall.val()||this.limitRoomFn(this.hall)){if(""==this.toilet.val()||this.limitRoomFn(this.toilet)){if(""!=this.obligee.val()&&!/^[\u4E00-\u9FA5，,]{2,200}/.test(this.obligee.val()))return layer.msg("委托人必须是中文，多个时必须以逗号隔开！"),this.elemBlurFn(this.obligee),void(t=!1);if(this.obligee.val().indexOf(",")>0){var r=this.obligee.val().substr(this.obligee.val().length-1,1);if(","==r||"，"==r){var i=this.obligee.val().substr(0,this.obligee.val().length-1);this.obligee.val(i)}if(this.obligee.val().split(",").length>7)return layer.msg("委托人必须是中文，多个时必须以逗号隔开！"),this.elemBlurFn(this.obligee),void(t=!1)}if(""!=this.taxation.val()&&!/^[1-9][0-9]*$/.test(this.taxation.val()))return layer.msg("请输入正确的税费！"),this.elemBlurFn(this.taxation),void(t=!1);if("暂无价格"!=yf.$params().jTotalPrice){var a=Number(1e4*yf.$params().jTotalPrice);if(""!=this.taxation.val()&&this.taxation.val()>a)return layer.msg("税费不能高于房屋总价！"),this.elemBlurFn(this.taxation),void(t=!1)}return this.reportParams.cityName=yf.userInfo.city,this.reportParams.comName=yf.$params().housingName,this.reportParams.regionName=yf.$params().istrative,this.reportParams.beLocated=this.houseLocal.val(),this.reportParams.housingConstructionArea=this.area.val(),this.reportParams.obligee=this.obligee.val(),this.reportParams.housingProperty=this.housingProperty.val(),this.reportParams.houseUse=this.houseUse.val(),this.reportParams.orientation=this.toward.val(),this.reportParams.exceptionalCase=this.exceptionalCase.val(),this.reportParams.room=this.room.val(),this.reportParams.hall=this.hall.val(),this.reportParams.toilet=this.toilet.val(),this.reportParams.housingLocationLayer=this.curFloor.val(),this.reportParams.totalNumberOfHouses=this.totalFloor.val(),this.reportParams.housingCompletionTime=this.buildYear.val(),this.reportParams.unitPrice=yf.$params().jUnitPrice,this.reportParams.totalPrice=yf.$params().jTotalPrice,this.reportParams.taxation=this.taxation.val(),this.reportParams.mortgagePrice=yf.$params().mortgagePrice,this.reportParams.mortgageTotalPrice=yf.$params().mortgageTotalPrice,t}t=!1}else t=!1;else t=!1},filterSelectStrFn:function(t){return void 0==t||""==t||null==t?"请选择":t},seeMoreFn:function(){var t=this;yf.scroll({elmId:t.preauditReport,height:"634"}),$("#see_more").off("click").click(function(){"更多"==$(this).text()?($(this).text("收起"),$("#more_info").removeClass("hide").stop(!0,!0).slideDown()):($(this).text("更多"),t.preauditReport.mCustomScrollbar("scrollTo","top"),setTimeout(function(){$("#more_info").removeClass("hide").stop(!0,!0).slideUp()},"300"))})},isMakePreviewRepFn:function(){var t=this;$("#makeReport").click(function(){var e=t.preauditReport.parent().parent().css("zIndex");t.checkRuleFn()&&layer.open({area:["auto","auto"],type:1,closeBtn:!1,title:!1,resize:!1,content:$("#report_affirm"),success:function(e,r){t.preauditReport.parent().parent().css("zIndex","100"),$("#backAdd").click(function(){layer.close(r);for(var e=0;e<t.reportContent.find("input").length;e++)""!=t.reportContent.find("input").eq(e).val()&&""!=$.trim(t.reportContent.find("input").eq(e).val())||t.reportContent.find("input").eq(e).css("borderColor","#db2029");""!=t.curFloor.val()&&""!=t.totalFloor.val()||t.curFloor.parent().css("borderColor","#db2029"),(""==t.room.val()||""==t.hall.val()||t.toilet.val())&&t.room.parent().css("borderColor","#db2029"),t.reportContent.find("input").click(function(){$(this).css("borderColor","#e6e6e6")})}),t.subPreviewFn()},end:function(){t.preauditReport.parent().parent().css("zIndex",e),$("#report_affirm").hide()}})})},subPreviewFn:function(){var t=$(window).height(),e=this;$("#preview_report").mCustomScrollbar({setHeight:t,scrollInertia:180,theme:"minimal-dark",axis:"y",alwaysShowScrollbar:2,callbacks:{whileScrolling:function(){parseInt($("#preview_report").find(".mCSB_dragger_onDrag").css("top"))>50?$("#back_top").show():$("#back_top").hide()}}}),$("#back_top").off("click").click(function(){$("#preview_report").mCustomScrollbar("scrollTo","top",function(){$("#back_top").hide()})}),$("#makePreview").off("click").click(function(){$("#back_top").hide(),yf.loading("#report_affirm"),e.demandPicNumFn()})},greatPreviewFn:function(){var t=this;server.getReport(t.reportParams).success(function(e){if(e.success){var r=$(window).height();layer.open({area:["auto",r+"px"],type:1,closeBtn:!1,title:!1,resize:!1,content:$("#preview_report"),success:function(r,i){$("#back_affirm").off("click").click(function(){layer.close(i)}),t.echoTempPageFn(e.data),t.downLoadRepFn(e.data.downRpRecordId),t.backToTopFn(),$(window).resize(function(){t.backToTopFn()})},end:function(){$("#preview_report").hide()}})}else layer.msg(e.msg);yf.removeLoading("#report_affirm")}).error(function(t){layer.msg(t.msg),yf.removeLoading("#report_affirm")})},downLoadRepFn:function(t){var e={reportId:t};$(".reportDownload").off("click").click(function(){yf.loading("#preview_report"),server.downReportFn(e).success(function(t){t.success?($("#rep_downLoad").attr("href",t.data),layer.open({type:"1",title:!1,closeBtn:!1,shadeClose:!1,resize:!1,area:["auto","auto"],content:$("#reportDownLoadPop"),success:function(t,e){$("#rep_cancel").off("click").click(function(){layer.close(e),yf.removeLoading("#preview_report")}),$("#rep_downLoad").off("click").click(function(){layer.close(e),yf.removeLoading("#preview_report"),layer.msg("下载成功")})},end:function(){$("#reportDownLoadPop").hide()}})):(layer.msg(t.msg),yf.removeLoading("#preview_report"))}).error(function(){})})},echoTempPageFn:function(t){$(".rep-valuationItemName").text(t.valuationItemName),$(".rep-pointOfValue").text(t.pointOfValue),$("#reportNum").text(t.reportNum),$("#valuationPrincipal").text(t.valuationPrincipal),$(".rep-buildingArea").text(t.buildingArea),$(".rep-unitPrice1").text(t.unitPrice),$(".rep-totalPrice").text(t.totalPrice),$(".rep-capitalamount").text(t.capitalamount),$(".rep-taxation").text(t.taxation),$(".rep-referenceValue").text(t.referenceValue),$("#prew_xqName").text(yf.$params().housingName),$("#prew_housingConstructionArea").html(t.housingConstructionArea+"㎡"),$("#prew_houseType").text(t.houseType),$("#prew_totleFloor").text(t.floor_TotleFloor),$("#prew_orientation").text(t.orientation),$("#prew_buildingTime1").text(t.buildingTime),$("#prew_housingProperty").text(t.housingProperty),$("#prew_houseUse").text(t.houseUse),$("#prew_exceptionalCase").text(t.exceptionalCase),$("#prew_bus").text(t.bus),$("#prew_subway").text(t.subway),$("#prew_supermarket").text(t.supermarket),$("#prew_school").text(t.school),$("#prew_hospital").text(t.hospital),$("#prew_bank").text(t.bank),""!=t.sealImg&&"-"!=t.sealImg&&$("#e_seal").attr("src",t.sealImg),""==t.mapImgUrl||void 0==t.mapImgUrl||null==t.mapImgUrl?($("#report_map").find("img").hide(),$("#report_map").html('<p class="text-center">暂无小区地图</p>')):$("#report_map img").show().attr("src",t.mapImgUrl),""==t.trendChartImgUrl||void 0==t.trendChartImgUrl||null==t.trendChartImgUrl?($("#report_chart").find("img").hide(),$("#report_chart").html('<p class="text-center">暂无价格走势图</p>')):$("#report_chart img").show().attr("src",t.trendChartImgUrl);var e="";if(t.listingCases.length>0)for(i=0;i<t.listingCases.length;i++)e+="<tr>\t\t\t\t\t\t\t<td>"+t.listingCases[i].unitPrice+"元/㎡</td>\t\t\t\t\t\t\t<td>"+t.listingCases[i].totalPrice+"万元</td>\t\t\t\t\t\t\t<td>"+t.listingCases[i].caseTime+"</td>\t\t\t\t\t\t\t<td>"+t.listingCases[i].buildingArea+"㎡</td>\t\t\t\t\t\t\t<td>"+t.listingCases[i].floors_fLOOR+"</td>\t\t\t\t\t\t\t<td>"+t.listingCases[i].toward+"</td>\t\t\t\t\t\t</tr>";else e='<tr><td class="text-center" colspan="6">暂无数据</td></tr>';$("#rep_listingCases").html(e);var r="";if(t.surroundingAreas.length>0)for(var i=0;i<t.surroundingAreas.length;i++)r+="<tr>\t\t\t\t\t\t\t<td>"+t.surroundingAreas[i].residentialAreaName+"</td>\t\t\t\t\t\t\t<td>"+t.surroundingAreas[i].unitPrice+"</td>\t\t\t\t\t\t\t<td>"+t.surroundingAreas[i].distance+"</td>\t\t\t\t\t\t\t</tr>";else r='<tr><td class="text-center" colspan="3">暂无数据</td></tr>';$("#rep_surroundingAreas").html(r),this.loadPicsFn(t.iDPhotos,t.realEstateLicensePhotos,t.housing_ResidentialPhotos)},loadPicsFn:function(t,e,r){var i="",a="",o="";if(t)for(s=0;s<t.length;s++)"—"!=t[s]&&(i+='<li><span><img src="'+t[s]+'" alt=""></span></li>');if($("#rep_iDPhotos").html(i),e)for(s=0;s<e.length;s++)"—"!=e[s]&&(a+='<li><span><img src="'+e[s]+'" alt=""></span></li>');if($("#rep_fangChanCard").html(a),r)for(var s=0;s<r.length;s++)"—"!=r[s]&&(o+='<li><span><img src="'+r[s]+'" alt=""></span></li>');$("#rep_housePhotos").html(o)},previewPicFn:function(){for(var t=$(".pic-box").length,e=this,r=0;r<t;r++)$(".pic-box").eq(r).find("input[type=file]").change(function(){var t=$(this).next(".thumb");if(!this.value||!yf.isIe()||navigator.userAgent.indexOf("MSIE 10.0")>0)if(this.files&&this.files[0]){$(t).html('<img class="imghead" />');var r=t.children(".imghead")[0],i=new FileReader;i.onload=function(t){r.src=t.target.result},i.readAsDataURL(this.files[0]),$(this).next(".thumb").attr("data-upload","true")}else $(this).next(".thumb").html(""),$(this).next(".thumb").attr("data-upload","true"),e.reportParams[$(this).attr("id")]="";else{this.select(),this.blur();var a=document.selection.createRange().text;$(t).html('<div class="divhead inline" style="width:108px;height:108px">');t.children(".divhead")[0].filters.item("DXImageTransform.Microsoft.AlphaImageLoader").src=a}})},uploadPicFn:function(fileId){var _this=this;$.ajaxFileUpload({url:"/api/v1/preliminaryReport/imageUpload",secureuri:!1,fileElementId:fileId,type:"post",dataType:"text",data:{cityName:yf.userInfo.city},success:function(data){var data=eval("("+data+")");data.success?(_this.picNum--,_this.picArr.push(data.data.imgUrl),_this.reportParams[fileId]=data.data.imgUrl,$("#"+fileId).next(".thumb").attr("data-upload","false"),0==_this.picNum&&_this.greatPreviewFn()):(layer.msg(data.msg),yf.removeLoading("#report_affirm"))},error:function(t){layer.msg(t.msg),yf.removeLoading("#report_affirm")}})},demandPicNumFn:function(){for(var t=this.thumb.length,e=0;e<t;e++)if(this.thumb.eq(e).children().length>0&&"true"==this.thumb.eq(e).attr("data-upload")){var r=this.thumb.eq(e).prev().attr("id");this.picNum++,this.uploadPicFn(r)}0==this.picNum&&this.greatPreviewFn()},autoScrollFn:function(){var t=this,e={1:"一",2:"二",3:"三",4:"四",5:"五",6:"六",7:"七"};layui.use(["carousel","form"],function(){var r=layui.carousel;t.form=layui.form,t.form.render("select"),r.render({elem:"#house_pic",width:"100%",arrow:"always",autoplay:!1,indicator:"none",height:"112px"}),r.on("change(house_pic)",function(t){$("#curPage").text(e[t.index+1])})})},limitRoomFn:function(t){var e=!0;return/^[1-9][0-9]{0,1}$/.test(t.val())?e:(layer.msg("请输入1-99之间的任意数字"),this.elemBlurFn(t.parent()),void(e=!1))},elemBlurFn:function(t){t.css("borderColor","#db2029")},backToTopFn:function(){if(window.ActiveXObject||"ActiveXObject"in window){var t=$("#preaudit_report").width()+$("#preaudit_report").offset().left+20;$("#back_top").css("left",t+"px")}}}.init()});