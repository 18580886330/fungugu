!function(e){function i(e){return{swf:"/src/content/js/third/webUpload/Uploader.swf",pick:{id:e,label:"点击选择图片"},accept:{title:"Images",extensions:"gif,jpg,jpeg,bmp,png",mimeTypes:"image/bmp,image/jpg,image/jpeg,image/png"},thumb:{width:110,height:99,quality:70,allowMagnify:!1,crop:!0,type:"image/jpeg"},method:"POST",server:"",sendAsBinary:!1,chunked:!1,chunkSize:524288,fileNumLimit:50,fileSizeLimit:209715200,fileSingleSizeLimit:5242880}}function t(i){if(WebUploader.Uploader.support())return new WebUploader.Uploader(i);e("#isSupport").removeClass("hide")}function a(e,i,t){e>=100?(e+="%",t=t||"上传中......"):(e+="%",t=t||e);var a=i.find(".diyProgress"),n=i.find(".diyProgressText");a.width(e),n.text(t)}function n(e,i,t){t.removeFile(i),e.siblings("li").length<=0?e.parents(".parentFileBox").remove():e.remove()}function l(i,t,a,l){var o=t.id,s=i.next(".parentFileBox");if(s.length<=0){c='<div class="parentFileBox"> \t\t\t\t\t\t<ul class="fileBoxUl"></ul>\t\t\t\t\t</div>';i.after(c),s=i.next(".parentFileBox")}if(s.find(".diyButton").length<=0){var c='<div class="diyButton"> \t\t\t\t\t\t<a class="diyCancelAll" href="javascript:void(0)">全部取消</a> \t\t\t\t\t\t<a class="diyStart" href="javascript:void(0)">开始上传</a> \t\t\t\t\t</div>';s.append(c);var f=s.find(".diyStart"),u=s.find(".diyCancelAll");f.one("click",function(){a.upload()}),u.bind("click",function(){var i=a.getFiles("queued");e.each(i,function(i,t){n(e("#fileBox_"+t.id),t.id,a)})})}e(".diyButton").hide();var p='<li id="fileBox_'+o+'" class="diyUploadHover" data-reup="true"> \t\t\t\t\t<div class="viewThumb"></div> \t\t\t\t\t<div class="diyCancel"></div> \t\t\t\t\t<div class="diySuccess"></div> \t\t\t\t\t<div class="diyFileName">'+t.name+'</div>\t\t\t\t\t<div class="diyBar"> \t\t\t\t\t\t\t<div class="diyProgress"></div> \t\t\t\t\t\t\t<div class="diyProgressText">0%</div> \t\t\t\t\t</div> \t\t\t\t</li>';s.children(".fileBoxUl").append(p),d("chooseHead",a),d("chooseJrcode",a),d("license",a),d("credit",a);var v=s.find("#fileBox_"+o);v.children(".diyCancel").one("click",function(){n(e(this).parent("li"),o,a)});if("image"==t.type.split("/")[0])a.makeThumb(t,function(e,i){e||v.find(".viewThumb").append('<img src="'+i+'" >')});else{var m=r(t.name.split(".").pop());r(t.name.split(".")[1]);v.addClass(m)}}function d(i,t){if(e("#"+i).siblings(".parentFileBox").find(".fileBoxUl li").length>1){var a=e("#"+i).siblings(".parentFileBox").find(".fileBoxUl li").eq(0).attr("id").split("fileBox_")[1];e("#"+i).siblings(".parentFileBox").find(".fileBoxUl li").eq(0).remove(),t.removeFile(a)}}function r(e){var i={};return i.xls="xls",i.xlsx="xls",(i=i[e]||"txt")+"_diy_bg"}e.fn.extend({diyUpload:function(n,d){if("object"==typeof n){var r=e(this),o=r.attr("id");if(n.url&&(n.server=n.url,delete n.url),n.success){var s=n.success;delete n.success}if(n.error){var c=n.error;delete n.error}e.each(i("#"+o),function(e,i){n[e]=n[e]||i}),n.buttonText&&(n.pick.label=n.buttonText,delete n.buttonText);var f=t(n);if(f){f.on("beforeFileQueued",function(i){if(e("#"+o).siblings(".parentFileBox").find("ul li").length>=2)return layer.msg("图片上传超过限制"),!1}),f.on("fileQueued",function(e){l(r,e,f)}),f.on("uploadProgress",function(i,t){var n=e("#fileBox_"+i.id).find(".diyBar");n.show(),a((t*=100).toFixed(2),n)}),f.on("uploadFinished",function(){r.next(".parentFileBox").children(".diyButton").remove()}),f.on("uploadAccept",function(e,i){d&&d(i)});var u="";f.on("uploadSuccess",function(i,t){var a=e("#fileBox_"+i.id),n=a.find(".diyBar");a.removeClass("diyUploadHover"),200==t.code?(u=t.data.fileName,a.removeAttr("data-reup"),e(a).attr("data-fileName",t.data.fileName),e(a).attr("data-valid",t.data.isThisUpload),n.fadeOut(1e3,function(){a.children(".diyCancel").hide(),a.children(".diySuccess").show()}),s&&s(t)):layer.msg("登录过期，请重新登录")}),f.on("uploadBeforeSend",function(e,i){}),f.on("uploadError",function(i,t){a(0,e("#fileBox_"+i.id).find(".diyBar"),"上传失败!");var n="上传失败! 文件:"+i.name+" 错误码:"+t;c&&c(n)}),f.on("error",function(e){var i="";switch(e){case"F_DUPLICATE":i="该文件已经被选择了!";break;case"Q_EXCEED_NUM_LIMIT":i="上传文件数量超过限制!";break;case"F_EXCEED_SIZE":i="文件大小超过限制!";break;case"Q_EXCEED_SIZE_LIMIT":i="所有文件总大小超过限制!";break;case"Q_TYPE_DENIED":i="文件类型不正确或者是空文件!";break;default:i="未知错误!"}layer.msg(i)})}}else alert("参数错误!")}})}(jQuery);